/*! For license information please see shaku.min.js.LICENSE.txt */
(()=>{"use strict";var t={3155:t=>{t.exports=class{constructor(t){this._url=t,this._waitingCallbacks=[]}get ready(){return null===this._waitingCallbacks}onReady(t){this.valid||this.ready?t(this):this._waitingCallbacks.push(t)}waitForReady(){return new Promise(((t,e)=>{this.onReady(t)}))}_notifyReady(){if(this._waitingCallbacks){for(let t=0;t<this._waitingCallbacks.length;++t)this._waitingCallbacks[t](this);this._waitingCallbacks=null}}get url(){return this._url}get valid(){throw new Error("Not Implemented!")}load(t){throw new Error("Not Implemented!")}create(t,e){throw new Error("Not Supported for this asset type.")}destroy(){throw new Error("Not Implemented!")}}},7148:(t,e,i)=>{const r=i(499),s=i(9563),n=i(3603),o=i(7058),a=i(2262),l=i(167),h=i(1252),u=(i(3155),i(2493),i(2493)),d=(i(2544),i(5259).getLogger("assets"));var c=0;t.exports=new class extends s{constructor(){super(),this._loaded=null,this._waitingAssets=new Set,this._failedAssets=new Set,this._successfulLoadedAssetsCount=0,this.root="",this.suffix=""}#t(t){return t?this.root+t+this.suffix:t}get pendingAssets(){return Array.from(this._waitingAssets)}get failedAssets(){return Array.from(this._failedAssets)}waitForAll(){return new Promise(((t,e)=>{d.debug("Waiting for all assets..");let i=()=>0!==this._failedAssets.size?(d.warn("Done waiting for assets: had errors."),e(this.failedAssets)):0===this._waitingAssets.size?(d.debug("Done waiting for assets: everything loaded successfully."),t()):void setTimeout(i,1);i()}))}setup(){return new Promise(((t,e)=>{d.info("Setup assets manager.."),this._loaded={},t()}))}startFrame(){}endFrame(){}#e(t,e){let i=this._loaded[t]||null;if(i&&e&&!(i instanceof e))throw new Error(`Asset with URL '${t}' is already loaded, but has unexpected type (expecting ${e})!`);return i}async#i(t,e){let i=t.url,r=t.constructor.name;return this._loaded[i]=t,this._waitingAssets.add(i),new Promise((async(s,n)=>{d.debug(`Load asset [${r}] from URL '${i}'.`);try{await t.load(e)}catch(t){return d.warn(`Failed to load asset [${r}] from URL '${i}'.`),this._failedAssets.add(i),n(t)}if(this._waitingAssets.delete(i),!t.valid)return d.warn(`Failed to load asset [${r}] from URL '${i}'.`),this._failedAssets.add(i),n("Loaded asset is not valid!");d.debug(`Successfully loaded asset [${r}] from URL '${i}'.`),this._successfulLoadedAssetsCount++,s(t)}))}getCached(t){return t=this.#t(t),this._loaded[t]||null}#r(t,e,i){t=this.#t(t);let r=this.#e(t,e);var s=!1;r||(r=new e(t),s=!0);let n=new Promise((async(t,e)=>{s&&await this.#i(r,i),r.onReady((()=>{t(r)}))}));return n.asset=r,n}#s(t,e,i,r){t=this.#t(t);var s=new e(t||"_runtime_asset_"+c+++"_");r&&this._waitingAssets.add(t);let n=new Promise((async(r,n)=>{if(t&&this._loaded[t])return n(`Asset of type '${e.name}' to create with URL '${t}' already exist in cache!`);await i(s),t&&(this._loaded[t]=s),r(s)}));return n.asset=s,n}loadSound(t){return this.#r(t,r,void 0)}loadTexture(t,e){return this.#r(t,a,e)}createRenderTarget(t,e,i,r){if(!e||!i)throw new Error("Missing or invalid size!");return this.#s(t,a,(t=>{t.createRenderTarget(e,i,r)}))}createTextureAtlas(t,e,i,r,s){if(!e||!e.length)throw new Error("Missing or invalid sources!");return this.#s(t,u,(async n=>{try{await n._build(e,i,r,s),this._waitingAssets.delete(t),this._successfulLoadedAssetsCount++}catch(t){d.warn(`Failed to create texture atlas: '${t}'.`),this._failedAssets.add(url)}}),!0)}loadFontTexture(t,e){return this.#r(t,l,e)}loadMsdfFontTexture(t,e){return this.#r(t,h,e)}loadJson(t){return this.#r(t,o)}createJson(t,e){return e?this.#s(t,o,(t=>{t.create(e)})):reject("Missing or invalid data!")}loadBinary(t){return this.#r(t,n)}createBinary(t,e){return e?this.#s(t,n,(t=>{t.create(e)})):reject("Missing or invalid data!")}free(t){t=this.#t(t);let e=this._loaded[t];e&&(e.destroy(),delete this._loaded[t])}clearCache(){for(let t in this._loaded)this._loaded[t].destroy();this._loaded={},this._waitingAssets=new Set,this._failedAssets=new Set}destroy(){this.clearCache()}}},3603:(t,e,i)=>{const r=i(3155);t.exports=class extends r{constructor(t){super(t),this._data=null}load(){return new Promise(((t,e)=>{var i=new XMLHttpRequest;i.open("GET",this.url,!0),i.responseType="arraybuffer",i.onload=()=>{4==i.readyState&&(i.response?(this._data=new Uint8Array(i.response),this._notifyReady(),t()):e(i.statusText))},i.onerror=t=>{e(t)},i.send()}))}create(t){return new Promise(((e,i)=>{if(Array.isArray(t)&&(t=new Uint8Array(t)),!(t instanceof Uint8Array))return i("Binary asset source must be of type 'Uint8Array'!");this._data=t,this._notifyReady(),e()}))}get valid(){return Boolean(this._data)}destroy(){this._data=null}get data(){return this._data}string(){return(new TextDecoder).decode(this._data)}}},167:(t,e,i)=>{const r=i(3155),s=i(2544),n=i(4731),o=i(2262);class a extends r{constructor(t){super(t),this._fontName=null,this._fontSize=null,this._placeholderChar=null,this._sourceRects=null,this._texture=null,this._lineHeight=0}get lineHeight(){return this._lineHeight}get fontName(){return this._fontName}get fontSize(){return this._fontSize}get placeholderCharacter(){return this._placeholderChar}get texture(){return this._texture}load(t){return new Promise((async(e,i)=>{if(!t||!t.fontName)return i("When loading font texture you must provide params with a 'fontName' value!");this._placeholderChar=(t.missingCharPlaceholder||"?")[0];let r=void 0===t.smoothFont||t.smoothFont,h=t.extraPadding||{x:0,y:0},u=t.maxTextureWidth||1024,d=t.charactersSet||a.defaultCharactersSet;-1===d.indexOf(this._placeholderChar)&&(d+=this._placeholderChar);let c=new FontFace(t.fontName,`url(${this.url})`);await c.load(),document.fonts.add(c),this._fontName=t.fontName,this._fontSize=t.fontSize||52;let f=this.fontSize.toString()+"px "+this.fontName,_=function(t,e,i,r){let s=document.createElement("pre");s.style.fontFamily=t,s.style.fontSize=e+"px",s.style.paddingBottom=s.style.paddingLeft=s.style.paddingTop=s.style.paddingRight="0px",s.style.marginBottom=s.style.marginLeft=s.style.marginTop=s.style.marginRight="0px",s.textContent="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",document.body.appendChild(s);let n=s.getBoundingClientRect().height+(r||0);return document.body.removeChild(s),Math.ceil(n)}(this.fontName,this.fontSize,0,h.y),g=function(t,e,i,r){let s=document.createElement("canvas").getContext("2d");s.font=e.toString()+"px "+t;let n=0,o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";for(let t=0;t<o.length;++t)n=Math.max(n,s.measureText(o[t]).width+(r||0));return Math.ceil(n)}(this.fontName,this.fontSize,0,h.x);this._lineHeight=_;let m=new s(g+20,_+10),p=Math.floor(u/m.x),x=Math.min(d.length*m.x,u),y=Math.ceil(d.length/p)*m.y;(t.enforceTexturePowerOfTwo||void 0===t.enforceTexturePowerOfTwo)&&(x=l(x),y=l(y)),this._sourceRects={};let w=document.createElement("canvas");w.width=x,w.height=y,r||(w.style.webkitFontSmoothing="none",w.style.fontSmooth="never",w.style.textRendering="geometricPrecision");let b=w.getContext("2d");b.textBaseline="bottom",b.font=f,b.fillStyle="#ffffffff",b.imageSmoothingEnabled=r;let v=0,T=0;for(let e=0;e<d.length;++e){let i=d[e],r=Math.ceil(b.measureText(i).width+h.x);v+r>x&&(T+=Math.round(_+5),v=0);const s=t.sourceRectOffsetAdjustment||{x:0,y:0};let o=new n(v+s.x,T+s.y,r,_);this._sourceRects[i]=o,b.fillText(i,v,T+_),v+=Math.round(r+10)}if(!r){let t=b.getImageData(0,0,b.canvas.width,b.canvas.height),e=t.data;for(let t=0;t<e.length;t+=4)e[t+3]>0&&(e[t+3]<255||e[t]<255||e[t+1]<255||e[t+2]<255)&&(e[t+3]=0);b.putImageData(t,0,0)}let S=new Image;S.src=w.toDataURL("image/png"),S.onload=()=>{let t=new o(this.url+"__font-texture");t.fromImage(S),this._texture=t,this._notifyReady(),e()}}))}get width(){return this._texture._width}get height(){return this._texture._height}getSize(){return this._texture.getSize()}get valid(){return Boolean(this._texture)}getSourceRect(t){return this._sourceRects[t]||this._sourceRects[this.placeholderCharacter]}getPositionOffset(t){return s.zero()}getXAdvance(t){return this.getSourceRect(t).width}destroy(){this._texture&&this._texture.destroy(),this._fontName=null,this._fontSize=null,this._placeholderChar=null,this._sourceRects=null,this._texture=null,this._lineHeight=0}}function l(t){let e=2;for(;e<t;){if(e>=t)return e;e*=2}return e}a.defaultCharactersSet=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾",t.exports=a},7817:(t,e,i)=>{t.exports=i(7148)},7058:(t,e,i)=>{const r=i(3155);t.exports=class extends r{constructor(t){super(t),this._data=null}load(){return new Promise(((t,e)=>{var i=new XMLHttpRequest;i.open("GET",this.url,!0),i.responseType="json",i.onload=()=>{4==i.readyState&&(i.response?(this._data=i.response,this._notifyReady(),t()):200===i.status?e("Response is not a valid JSON!"):e(i.statusText))},i.onerror=t=>{e(t)},i.send()}))}create(t){return new Promise(((e,i)=>{try{t=t?"string"==typeof t?JSON.parse(t):JSON.parse(JSON.stringify(t)):{}}catch(t){return i("Data is not a valid JSON serializable object!")}this._data=t,this._notifyReady(),e()}))}get data(){return this._data}get valid(){return Boolean(this._data)}destroy(){this._data=null}}},1252:(t,e,i)=>{const r=i(2544),s=i(4731),n=i(2262),o=i(167),a=i(7058),l=i(5387);t.exports=class extends o{constructor(t){super(t),this._positionOffsets=null,this._xAdvances=null}load(t){return new Promise((async(e,i)=>{if(!t||!t.jsonUrl||!t.textureUrl)return i("When loading an msdf font you must provide params with a 'jsonUrl' and a 'textureUrl'!");let o=new a(t.jsonUrl),h=new n(t.textureUrl);await Promise.all([o.load(),h.load()]);let u=o.data;if(h.filter=l.Linear,u.common.pages>1)throw new Error("Can't use MSDF font with several pages");if(this._placeholderChar=(t.missingCharPlaceholder||"?")[0],!u.info.charset.includes(this._placeholderChar))throw new Error("The atlas' charset doesn't include the given placeholder character");this._fontName=u.info.face,this._fontSize=u.info.size,this._lineHeight=u.common.lineHeight,this._sourceRects={},this._positionOffsets={},this._xAdvances={},this._kernings={};for(const t of u.chars){let e=t.char,i=new s(t.x,t.y,t.width,t.height);this._sourceRects[e]=i,this._positionOffsets[e]=new r(t.xoffset,t.yoffset),this._xAdvances[e]=t.xadvance}this._texture=h,this._notifyReady(),e()}))}get width(){return this._texture._width}get height(){return this._texture._height}getSize(){return this._texture.getSize()}getPositionOffset(t){return this._positionOffsets[t]||this._positionOffsets[this.placeholderCharacter]}getXAdvance(t){return this._xAdvances[t]||this._xAdvances[this.placeholderCharacter]}destroy(){super.destroy(),this._positionOffsets=null,this._xAdvances=null,this._kernings=null}}},499:(t,e,i)=>{const r=i(3155);t.exports=class extends r{constructor(t){super(t),this._valid=!1}load(){return new Promise(((t,e)=>{var i=new XMLHttpRequest;i.open("GET",this.url,!0),i.responseType="arraybuffer",i.onload=()=>{this._valid=!0,this._notifyReady(),t()},i.onerror=t=>{e(t)},i.send()}))}get valid(){return this._valid}destroy(){this._valid=!1}}},2262:(t,e,i)=>{const r=i(9327),s=i(4397),n=i(5259).getLogger("assets");var o=null;function a(t){return 0==(t&t-1)}t.exports=class extends s{constructor(t){super(t),this._image=null,this._width=0,this._height=0,this._texture=null,this._ctxForPixelData=null}static _setWebGl(t){o=t}load(t){return t=t||{},new Promise(((e,i)=>{if(!o)return i("Can't load textures before initializing gfx manager!");const r=new Image;void 0!==t.crossOrigin&&(r.crossOrigin=t.crossOrigin),r.onload=async()=>{try{await this.create(r,t),this._notifyReady(),e()}catch(t){i(t)}},r.onerror=()=>{i("Failed to load texture image!")},r.src=this.url}))}createRenderTarget(t,e,i){o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);const r=t,s=e,n=o.createTexture();o.bindTexture(o.TEXTURE_2D,n);var a=o.RGBA;if(void 0!==i)switch(i){case 1:a=o.LUMINANCE;break;case 3:a=o.RGB;break;case 4:a=o.RGBA;break;default:throw new Error("Unknown render target format!")}{const t=0,e=a,i=0,n=a,l=o.UNSIGNED_BYTE,h=null;o.texImage2D(o.TEXTURE_2D,t,e,r,s,i,n,l,h),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)}this._width=t,this._height=e,this._texture=n,this._notifyReady()}fromImage(t,e){if(0===t.width)throw new Error("Image to build texture from must be loaded and have valid size!");if(this.valid)throw new Error("Texture asset is already initialized!");e=e||{},o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,Boolean(e.flipY)),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Boolean(e.premultiplyAlpha)),this._image=t,this._width=t.width,this._height=t.height;const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);const r=o.RGBA,s=o.RGBA,l=o.UNSIGNED_BYTE;o.bindTexture(o.TEXTURE_2D,i),o.texImage2D(o.TEXTURE_2D,0,r,s,l,t),e.generateMipMaps&&(a(t.width)&&a(t.height)&&n.warn("Tried to generate MipMaps for a texture with size that is *not* a power of two. This might not work as expected."),o.generateMipmap(o.TEXTURE_2D)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),this._texture=i,this._notifyReady()}create(t,e){return new Promise((async(i,r)=>{if("string"==typeof t){let r=new Image;r.onload=()=>{this.fromImage(t,e),this._notifyReady(),i()},void 0!==e.crossOrigin&&(r.crossOrigin=e.crossOrigin),r.src=t}else this.fromImage(t,e),i()}))}get image(){return this._image}get width(){return this._width}get height(){return this._height}get _glTexture(){return this._texture}getPixel(t,e){if(!this._image)throw new Error("'getPixel()' only works on textures loaded from image!");if(!this._ctxForPixelData){let t=document.createElement("canvas");t.width=1,t.height=1,this._ctxForPixelData=t.getContext("2d")}let i=this._ctxForPixelData;i.drawImage(this._image,t,e,1,1,0,0,1,1);let s=i.getImageData(0,0,1,1).data;return r.fromBytesArray(s)}getPixelsData(t,e,i,s){if(!this._image)throw new Error("'getPixel()' only works on textures loaded from image!");if(t=t||0,e=e||0,i=i||this.width-t,s=s||this.height-e,!this._ctxForPixelData){let t=document.createElement("canvas");t.width=i,t.height=s,this._ctxForPixelData=t.getContext("2d")}let n=this._ctxForPixelData;n.drawImage(this._image,t,e,i,s,0,0,i,s);let o=n.getImageData(t,e,i,s).data,a=[];for(let t=0;t<i;++t){let e=[];a.push(e);for(let n=0;n<s;++n)e.push(r.fromBytesArray(o,4*t+4*n*i))}return a}get valid(){return Boolean(this._texture)}destroy(){o.deleteTexture(this._texture),this._image=null,this._width=this._height=0,this._ctxForPixelData=null,this._texture=null}}},4397:(t,e,i)=>{const r=i(3155),{TextureFilterMode:s}=i(5387),{TextureWrapMode:n}=i(2464),o=i(2544);t.exports=class extends r{constructor(t){super(t),this._filter=null,this._wrapMode=null}get filter(){return this._filter}set filter(t){this._filter=t}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode=t}get image(){throw new Error("Not Implemented!")}get width(){throw new Error("Not Implemented!")}get height(){throw new Error("Not Implemented!")}getSize(){return new o(this.width,this.height)}get _glTexture(){throw new Error("Not Implemented!")}}},2493:(t,e,i)=>{const r=i(3624),{Rectangle:s}=i(3624),n=(i(2544),i(3155)),o=i(2262),a=i(8609);i(5259).getLogger("assets");var l=null;function h(t,e,i,s){e=e||l.MAX_TEXTURE_SIZE,i=i||l.MAX_TEXTURE_SIZE;let n=r.ItemsSorter.arrangeRectangles(t,(t=>{let i=1;for(;i<t;)i*=2;return t=i,Math.min(t,e)}),s);if(n.height>i){n.height=i,n.leftovers=[];for(let t=n.rectangles.length-1;t>=0;--t){let e=n.rectangles[t];e.y+e.height>i&&(n.rectangles.splice(t,1),n.leftovers.push(e.source))}}return n}function u(t){return new Promise(((e,i)=>{const r=new Image;r.crossOrigin="Anonymous",r.src=t,r.__origin_url=t,r.onload=()=>{e(r)},r.onerror=t=>{i(t)}}))}t.exports=class extends n{constructor(t){super(t),this.__textures=[],this.__sources={}}static _setWebGl(t){l=t}async _build(t,e,i,r){if(this.__textures.length)throw new Error("Texture Atlas already built!");return new Promise((async(n,d)=>{for(t=await async function(t){return new Promise((async(e,i)=>{let r=[],s=[];for(let e=0;e<t.length;++e){let n=t[e];"string"==typeof n?r.push(u(n)):n instanceof Image?n.width?s.push(n):r.push(new Promise(((t,e)=>{n.onload=t(n),n.onerror=e}))):i(`Invalid source type: ${n}. All sources must be either Image instances or URLs (string).`)}for(let t of r)s.push(await t);e(s)}))}(t),e>l.MAX_TEXTURE_SIZE&&(e=l.MAX_TEXTURE_SIZE),i>l.MAX_TEXTURE_SIZE&&(i=l.MAX_TEXTURE_SIZE);t&&t.length;){let n=h(t,e,i,r),l=new o(`_atlas_${this.url}_${this.__textures.length}`),d=document.createElement("canvas");d.width=n.width,d.height=n.height;let c=d.getContext("2d"),f=0;for(let t of n.rectangles){c.drawImage(t.source,t.x,t.y);let e=t.source.src,i=t.source.__origin_url,r=e.substr(location.origin.length),n=l.url+"_"+(f++).toString()+"_"+e.replaceAll("/","_").replaceAll(":",""),o=new s(t.x,t.y,t.width,t.height),h=new a(n,l,o,this);this.__sources[e]=this.__sources[r]=this.__sources[r.substr(1)]=h,i&&(this.__sources[i]=this.__sources[e])}let _=d.toDataURL(),g=await u(_);l.fromImage(g),l.utilized=n.utilized,this.__textures.push(l),t=n.leftovers}n()}))}get textures(){return this.__textures.slice(0)}getTexture(t){return this.__sources[t]||null}get valid(){return Boolean(this.__textures.length)}destroy(){for(let t of this.__textures)t.destroy();this.__textures=[],this.__sources={}}}},8609:(t,e,i)=>{const r=i(4397),s=i(4731);t.exports=class extends r{constructor(t,e,i,r){super(t),this._texture=e,this._sourceRect=i,this._atlas=r}get sourceRectangle(){return this._sourceRect}get sourceRectangleNormalized(){return this._sourceRectNormalized||(this._sourceRectNormalized=new s(this._sourceRect.x/this.width,this._sourceRect.y/this.height,this._sourceRect.width/this.width,this._sourceRect.height/this.height)),this._sourceRectNormalized}get texture(){return this._texture}get atlas(){return this._atlas}get image(){return this.texture.image}get width(){return this.texture.width}get height(){return this.texture.height}get _glTexture(){return this.texture._glTexture}get valid(){return Boolean(this.texture.valid)}destroy(){}}},4843:(t,e,i)=>{const r=i(9563),s=(i(2544),i(2433)),n=i(5528),o=i(9481),a=i(1282),l=i(4153),h=i(1596),u=i(6527),d=i(6601),c=i(5259).getLogger("collision");t.exports=new class extends r{constructor(){super(),this.resolver=new n}setup(){return new Promise(((t,e)=>{c.info("Setup collision manager.."),this.resolver._init(),this.resolver.setHandler("point","point",h.pointPoint),this.resolver.setHandler("point","circle",h.pointCircle),this.resolver.setHandler("point","rect",h.pointRectangle),this.resolver.setHandler("point","lines",h.pointLine),this.resolver.setHandler("point","tilemap",h.pointTilemap),this.resolver.setHandler("circle","circle",h.circleCircle),this.resolver.setHandler("circle","rect",h.circleRectangle),this.resolver.setHandler("circle","lines",h.circleLine),this.resolver.setHandler("circle","tilemap",h.circleTilemap),this.resolver.setHandler("rect","rect",h.rectangleRectangle),this.resolver.setHandler("rect","lines",h.rectangleLine),this.resolver.setHandler("rect","tilemap",h.rectangleTilemap),this.resolver.setHandler("lines","lines",h.lineLine),this.resolver.setHandler("lines","tilemap",h.lineTilemap),t()}))}createWorld(t){return new s(this.resolver,t)}get RectangleShape(){return l}get PointShape(){return a}get CircleShape(){return o}get LinesShape(){return u}get TilemapShape(){return d}startFrame(){}endFrame(){}destroy(){}}},2433:(t,e,i)=>{const r=i(9327),s=i(2544),n=i(9668),o=(i(6323),i(9135),i(7565)),a=i(4731),l=(i(5528),i(1282)),h=i(9481),u=(i(1772),i(5259).getLogger("collision"));t.exports=class{constructor(t,e){this.resolver=t,e=void 0===e?new s(512,512):"number"==typeof e?new s(e,e):e.clone(),this._gridCellSize=e,this._grid={},this._shapesToUpdate=new Set,this._cellsToDelete=new Set,this.resetStats()}resetStats(){this._stats={updatedShapes:0,addedShapes:0,deletedGridCells:0,createdGridCell:0,broadPhaseShapesChecksPrePredicate:0,broadPhaseShapesChecksPostPredicate:0,broadPhaseCalls:0,collisionChecks:0,collisionMatches:0}}get stats(){return this._stats}#n(){if(this._cellsToDelete.size>0){this._stats.deletedGridCells+=this._cellsToDelete.size;for(let t of this._cellsToDelete)this._grid[t]&&0===this._grid[t].size&&delete this._grid[t];this._cellsToDelete.clear()}if(this._shapesToUpdate.size>0){for(let t of this._shapesToUpdate)this.#o(t);this._shapesToUpdate.clear()}}#a(t,e){let i=t+","+e,r=this._grid[i];return r||(this._stats.createdGridCells++,this._grid[i]=r=new Set),r}#o(t){if(t._world!==this)return;this._stats.updatedShapes++;let e=t._getBoundingBox(),i=Math.floor(e.left/this._gridCellSize.x),r=Math.floor(e.top/this._gridCellSize.y),s=Math.ceil(e.right/this._gridCellSize.x),n=Math.ceil(e.bottom/this._gridCellSize.y);if(t._worldRange){if(t._worldRange[0]===i&&t._worldRange[1]===r&&t._worldRange[2]===s&&t._worldRange[3]===n)return;let e=t._worldRange[0],o=t._worldRange[1],a=t._worldRange[2],l=t._worldRange[3];for(let h=e;h<a;++h)for(let e=o;e<l;++e){if(h>=i&&h<s&&e>=r&&e<n)continue;let o=h+","+e,a=this._grid[o];a&&(a.delete(t),0===a.size&&this._cellsToDelete.add(o))}for(let h=i;h<s;++h)for(let i=r;i<n;++i)h>=e&&h<a&&i>=o&&i<l||this.#a(h,i).add(t)}else{this._stats.addedShapes++;for(let e=i;e<s;++e)for(let i=r;i<n;++i)this.#a(e,i).add(t)}t._worldRange=[i,r,s,n]}_queueUpdate(t){this._shapesToUpdate.add(t)}iterateShapes(t){for(let e in this._grid){let i=this._grid[e];if(i)for(let e of i)if(!1===t(e))return}}addShape(t){t._setParent(this),this.#o(t),this.#n()}removeShape(t){if(t._world===this){if(t._worldRange){let e=t._worldRange[0],i=t._worldRange[1],r=t._worldRange[2],s=t._worldRange[3];for(let n=e;n<r;++n)for(let e=i;e<s;++e){let i=n+","+e,r=this._grid[i];r&&(r.delete(t),0===r.size&&this._cellsToDelete.add(i))}}this._shapesToUpdate.delete(t),t._setParent(null),this.#n()}else u.warn("Shape to remove is not in this collision world!")}#l(t,e,i,r){let s=t._getBoundingBox(),n=Math.floor(s.left/this._gridCellSize.x),o=Math.floor(s.top/this._gridCellSize.y),a=Math.ceil(s.right/this._gridCellSize.x),l=Math.ceil(s.bottom/this._gridCellSize.y);this._stats.broadPhaseCalls++;let h=new Set;for(let s=n;s<a;++s)for(let n=o;n<l;++n){let o=s+","+n,a=this._grid[o];if(a)for(let s of a)if((!i||0!=(s.collisionFlags&i))&&!h.has(s)&&(h.add(s),s!==t&&(this._stats.broadPhaseShapesChecksPrePredicate++,(!r||r(s))&&(this._stats.broadPhaseShapesChecksPostPredicate++,!Boolean(e(s))))))return}}testCollision(t,e,i,r){this.#n();var s=null;if(e){var n=[];this.#l(t,(t=>(n.push(t),!0)),i,r),function(t,e){let i=t.getCenter();e.sort(((t,e)=>t.getCenter().distanceTo(i)-t._getRadius()-(e.getCenter().distanceTo(i)-e._getRadius())))}(t,n);var o=this.resolver.getHandlers(t);for(let e of n)if(this._stats.collisionChecks++,s=this.resolver.testWithHandler(t,e,o[e.shapeId])){this._stats.collisionMatches++;break}}else o=this.resolver.getHandlers(t),this.#l(t,(e=>(this._stats.collisionChecks++,(s=this.resolver.testWithHandler(t,e,o[e.shapeId]))&&this._stats.collisionMatches++,!s)),i,r);return s}testCollisionMany(t,e,i,r,s){this.#n();var n=[],o=this.resolver.getHandlers(t);return this.#l(t,(e=>{this._stats.collisionChecks++;let i=this.resolver.testWithHandler(t,e,o[e.shapeId]);return!i||(this._stats.collisionMatches++,n.push(i),!s||!1!==s(i))}),i,r),e&&function(t,e){let i=t.getCenter();e.sort(((t,e)=>t.second.getCenter().distanceTo(i)-t.second._getRadius()-(e.second.getCenter().distanceTo(i)-e.second._getRadius())))}(t,n),n}pick(t,e,i,r,s){let o=(e||0)<=1?new l(t):new h(new n(t,e));return this.testCollisionMany(o,i,r,s).map((t=>t.second))}setDebugDrawBatch(t){this.__debugDrawBatch=t}getOrCreateDebugDrawBatch(){return this.__debugDrawBatch||this.setDebugDrawBatch(new o.ShapesBatch),this.__debugDrawBatch}debugDraw(t,e,i,s){let n=this.getOrCreateDebugDrawBatch();n.begin(),this.#n(),t||((t=r.black).a*=.75),e||((e=r.red).a*=.75),void 0===i&&(i=.5),t.a*=.75*i,e.a*=.75*i;let l=new Set,h=s?s.getRegion():o._internal.getRenderingRegionInternal(!1),u=Math.floor(h.left/this._gridCellSize.x),d=Math.floor(h.top/this._gridCellSize.y),c=u+Math.ceil(h.width/this._gridCellSize.x),f=d+Math.ceil(h.height/this._gridCellSize.y);for(let r=u;r<=c;++r)for(let s=d;s<=f;++s){let o=this._grid[r+","+s],h=o&&o.size?e:t,u=new a(r*this._gridCellSize.x,s*this._gridCellSize.y,this._gridCellSize.x,2),d=new a(r*this._gridCellSize.x,s*this._gridCellSize.y,2,this._gridCellSize.y);if(n.drawRectangle(u,h),n.drawRectangle(d,h),o)for(let t of o)l.has(t)||(l.add(t),t.debugDraw(i,n))}n.end()}}},6740:(t,e,i)=>{t.exports=i(4843)},5528:(t,e,i)=>{const r=i(2544),s=i(6323),n=(i(9135),i(5259).getLogger("collision"));t.exports=class{constructor(){this._handlers={}}_init(){}setHandler(t,e,i){this._handlers[t]||(this._handlers[t]={}),this._handlers[t][e]=i,t!==e&&(this._handlers[e]||(this._handlers[e]={}),this._handlers[e][t]=(t,e)=>i(e,t))}test(t,e){let i=this.#h(t,e);return this.testWithHandler(t,e,i)}testWithHandler(t,e,i){if(!i)return n.warn(`Missing collision handler for shapes '${t.shapeId}' and '${e.shapeId}'.`),null;let o=i(t,e);return o?new s(o instanceof r?o:null,t,e):null}getHandlers(t){return this._handlers[t.shapeId]}#h(t,e){let i=this._handlers[t.shapeId];return i&&i[e.shapeId]||null}}},1596:t=>{const e={pointPoint:function(t,e){return!!t._position.approximate(e._position)&&t._position},pointCircle:function(t,e){return t._position.distanceTo(e._circle.center)<=e._circle.radius&&t._position},pointRectangle:function(t,e){return!!e._rect.containsVector(t._position)&&t._position},pointLine:function(t,e){for(let i=0;i<e._lines.length;++i)if(e._lines[i].containsVector(t._position))return t._position;return!1},pointTilemap:function(t,i){if(i._intBoundingRect.containsVector(t._position)){let r=i.getTileAt(t._position);return!!r&&e.pointRectangle(t,r)}return!(!i._borderThickness||!i._boundingRect.containsVector(t._position))&&t._position},circleCircle:function(t,e){return t._circle.center.distanceTo(e._circle.center)<=t._circle.radius+e._circle.radius},circleRectangle:function(t,e){return e._rect.collideCircle(t._circle)},circleLine:function(t,e){for(let i=0;i<e._lines.length;++i)if(e._lines[i].distanceToVector(t._circle.center)<=t._circle.radius)return!0;return!1},circleTilemap:function(t,i){let r=!1;return i.iterateTilesAtRegion(t._getBoundingBox(),(i=>{if(e.circleRectangle(t,i))return r=!0,!1})),r},rectangleRectangle:function(t,e){return t._rect.collideRect(e._rect)},rectangleLine:function(t,e){for(let i=0;i<e._lines.length;++i)if(t._rect.collideLine(e._lines[i]))return!0;return!1},rectangleTilemap:function(t,e){let i=!1;return e.iterateTilesAtRegion(t._getBoundingBox(),(t=>(i=!0,!1))),i},lineLine:function(t,e){for(let i=0;i<t._lines.length;++i)for(let r=0;r<e._lines.length;++r)if(t._lines[i].collideLine(e._lines[r]))return!0;return!1},lineTilemap:function(t,i){let r=!1;return i.iterateTilesAtRegion(t._getBoundingBox(),(i=>{if(e.rectangleLine(i,t))return r=!0,!1})),r}};t.exports=e},6323:(t,e,i)=>{i(2544),i(9135),t.exports=class{constructor(t,e,i){this.position=t,this.first=e,this.second=i}}},9481:(t,e,i)=>{const r=i(9135),s=(i(7565),i(9668),i(4731));t.exports=class extends r{constructor(t){super(),this.setShape(t)}get shapeId(){return"circle"}setShape(t){this._circle=t,this._position=t.center,this._boundingBox=new s(t.center.x-t.radius,t.center.y-t.radius,2*t.radius,2*t.radius),this._shapeChanged()}_getRadius(){return this._circle.radius}getCenter(){return this._position.clone()}_getBoundingBox(){return this._boundingBox}debugDraw(t,e){void 0===t&&(t=1);let i=this._getDebugColor();i.a*=t;let r=!(e=this._getDebugDrawBatch(e)).isDrawing;r&&e.begin(),e.drawCircle(this._circle,i,14),r&&e.end()}}},6527:(t,e,i)=>{const r=i(9135),s=(i(7565),i(1708),i(4731)),n=i(9668);t.exports=class extends r{constructor(t){super(),this._lines=[],this.addLines(t)}get shapeId(){return"lines"}addLines(t){Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;++e)this._lines.push(t[e]);let e=[];for(let t=0;t<this._lines.length;++t)e.push(this._lines[t].from),e.push(this._lines[t].to);this._boundingBox=s.fromPoints(e),this._circle=new n(this._boundingBox.getCenter(),Math.max(this._boundingBox.width,this._boundingBox.height)),this._shapeChanged()}setLines(t){this._lines=[],this.addLines(t)}_getRadius(){return this._circle.radius}getCenter(){return this._circle.center.clone()}_getBoundingBox(){return this._boundingBox}debugDraw(t,e){void 0===t&&(t=1);let i=this._getDebugColor();i.a*=t;let r=!(e=this._getDebugDrawBatch(e)).isDrawing;r&&e.begin();for(let t=0;t<this._lines.length;++t)e.drawLine(this._lines[t].from,this._lines[t].to,i);r&&e.end()}}},1282:(t,e,i)=>{const r=i(9135),s=(i(7565),i(2544),i(4731)),n=i(9668);t.exports=class extends r{constructor(t){super(),this.setPosition(t)}get shapeId(){return"point"}setPosition(t){this._position=t.clone(),this._boundingBox=new s(t.x,t.y,1,1),this._shapeChanged()}getPosition(){return this._position.clone()}getCenter(){return this._position.clone()}_getRadius(){return 1}_getBoundingBox(){return this._boundingBox}debugDraw(t,e){void 0===t&&(t=1);let i=this._getDebugColor();i.a*=t;let r=!(e=this._getDebugDrawBatch(e)).isDrawing;r&&e.begin(),e.drawCircle(new n(this.getPosition(),3),i,4),r&&e.end()}}},4153:(t,e,i)=>{i(4731);const r=i(9135);i(7565),t.exports=class extends r{constructor(t){super(),this.setShape(t)}get shapeId(){return"rect"}setShape(t){this._rect=t,this._center=t.getCenter(),this._radius=this._rect.getBoundingCircle().radius,this._shapeChanged()}_getRadius(){return this._radius}_getBoundingBox(){return this._rect}getCenter(){return this._center.clone()}debugDraw(t,e){void 0===t&&(t=1);let i=this._getDebugColor();i.a*=t;let r=!(e=this._getDebugDrawBatch(e)).isDrawing;r&&e.begin(),e.drawRectangle(this._rect,i),r&&e.end()}}},9135:(t,e,i)=>{i(1772);const r=i(9327);i(4731),i(2544),i(2433);const s=[r.red,r.blue,r.green,r.yellow,r.purple,r.teal,r.brown,r.orange,r.khaki,r.darkcyan,r.cornflowerblue,r.darkgray,r.chocolate,r.aquamarine,r.cadetblue,r.magenta,r.seagreen,r.pink,r.olive,r.violet];t.exports=class{constructor(){this._world=null,this._worldRange=null,this._debugColor=null,this._forceDebugColor=null,this._collisionFlags=Number.MAX_SAFE_INTEGER}get shapeId(){throw new Error("Not Implemented!")}get collisionFlags(){return this._collisionFlags}set collisionFlags(t){return this._debugColor=null,this._collisionFlags=t,this._collisionFlags}_getDebugDrawBatch(t){if(!t&&!this._world)throw new Error("Can't debug-draw a collision shape that is not under any collision world without providing a shapes batch to use!");return t||this._world.getOrCreateDebugDrawBatch()}setDebugColor(t){this._forceDebugColor=t}debugDraw(t,e){throw new Error("Not Implemented!")}getCenter(){throw new Error("Not Implemented!")}remove(){this._world&&this._world.removeShape(this)}_getDebugColor(){return this._forceDebugColor?this._forceDebugColor.clone():(this._debugColor||(this._debugColor=this._getDefaultDebugColorFor(this.collisionFlags)),this._debugColor.clone())}_getDefaultDebugColorFor(t){return s[t%s.length]}_getRadius(){throw new Error("Not Implemented!")}_getBoundingBox(){throw new Error("Not Implemented!")}_setParent(t){if(t!==this._world){if(this._world&&t)throw new Error("Cannot add collision shape to world while its already in another world!");this._world=t,this._worldRange=null}}_shapeChanged(){this._world&&this._world._queueUpdate(this)}}},6601:(t,e,i)=>{const r=i(9135),s=i(4731),n=i(2544),o=(i(7565),i(4153));t.exports=class extends r{constructor(t,e,i,r){super(),r=r||0,this._offset=t.clone(),this._intBoundingRect=new s(t.x,t.y,e.x*i.x,e.y*i.y),this._boundingRect=this._intBoundingRect.resize(2*r),this._center=this._boundingRect.getCenter(),this._radius=this._boundingRect.getBoundingCircle().radius,this._borderThickness=r,this._gridSize=e.clone(),this._tileSize=i.clone(),this._tiles={}}get shapeId(){return"tilemap"}_indexToKey(t){if(t.x<0||t.y<0||t.x>=this._gridSize.x||t.y>=this._gridSize.y)throw new Error(`Collision tile with index ${t.x},${t.y} is out of bounds!`);return t.x+","+t.y}setTile(t,e,i){let r=this._indexToKey(t);if(e){let e=this._tiles[r]||new o(new s(this._offset.x+t.x*this._tileSize.x,this._offset.y+t.y*this._tileSize.y,this._tileSize.x,this._tileSize.y));void 0!==i&&(e.collisionFlags=i),this._tiles[r]=e}else delete this._tiles[r]}getTileAt(t){let e=new n(Math.floor(t.x/this._tileSize.x),Math.floor(t.y/this._tileSize.y)),i=e.x+","+e.y;return this._tiles[i]||null}iterateTilesAtRegion(t,e){let i=t.getTopLeft(),r=t.getBottomRight(),s=new n(Math.floor(i.x/this._tileSize.x),Math.floor(i.y/this._tileSize.y)),o=new n(Math.floor(r.x/this._tileSize.x),Math.floor(r.y/this._tileSize.y));for(let t=s.x;t<=o.x;++t)for(let i=s.y;i<=o.y;++i){let r=t+","+i,s=this._tiles[r];if(s&&!1===e(s))return}}getTilesAtRegion(t){let e=[];return this.iterateTilesAtRegion(t,(t=>{e.push(t)})),e}_getRadius(){return this._radius}_getBoundingBox(){return this._boundingRect}getCenter(){return this._center.clone()}debugDraw(t,e){void 0===t&&(t=1);for(let i in this._tiles){let r=this._tiles[i];r.setDebugColor(this._forceDebugColor),r.debugDraw(t,e)}}}},3223:t=>{const e={AlphaBlend:"alpha",Opaque:"opaque",Additive:"additive",Multiply:"multiply",Subtract:"subtract",Screen:"screen",Overlay:"overlay",Invert:"invert",Darken:"darken",DestIn:"dest-in",DestOut:"dest-out"};Object.defineProperty(e,"_values",{value:new Set(Object.values(e)),writable:!1}),Object.freeze(e),t.exports={BlendModes:e}},2726:(t,e,i)=>{const r=i(4731),s=(i(2544),i(5529));i(8329),i(4353),t.exports=class{constructor(t){this.__region=null,this.__gfx=t,this.__viewport=null,this.orthographic()}get viewport(){return this.__viewport}set viewport(t){return this.__viewport=t,t}getRegion(){return this.__region.clone()}orthographicOffset(t,e,i,s){let n=e||!this.viewport?this.__gfx.getCanvasSize():this.viewport.getSize(),o=new r(t.x,t.y,n.x,n.y);this.orthographic(o,i,s)}orthographic(t,e,i){void 0===t&&(t=this.__gfx._internal.getRenderingRegionInternal()),this.__region=t,this.projection=s.createOrthographic(t.left,t.right,t.bottom,t.top,e||-1,i||400)}}},8871:(t,e,i)=>{const r=i(5529),s=i(8329),n=i(4353),o=i(2726);t.exports=class extends o{constructor(t){super(t),this.projection=null,this.view=null,this.perspective(),this.setViewLookat(new s(0,5,-10),s.zero())}calcVisibleFrustum(){if(!this.projection||!this.view)throw new Error("You must set both projection and view matrices to calculate visible frustum!");const t=new n;return t.setFromProjectionMatrix(r.multiply(this.projection,this.view)),t}setViewLookat(t,e){this.view=r.createLookAt(t||new s(0,0,-500),e||s.zeroReadonly,s.upReadonly)}getDirection(){const t=this.view.values;return new s(-t[8],-t[9],-t[10]).normalizeSelf()}getViewProjection(){r.multiply(this.view,this.projection)}perspective(t,e,i,s){this.projection=r.createPerspective(t||Math.PI/2,e||1,i||.1,s||1e3)}}},8117:t=>{const e={StaticDraw:"static",DynamicDraw:"dynamic",StreamDraw:"stream"};Object.defineProperty(e,"_values",{value:new Set(Object.values(e)),writable:!1}),Object.freeze(e),t.exports={BuffersUsage:e}},2069:(t,e,i)=>{const{BlendModes:r}=i(3223),{BuffersUsage:s}=i(8117),n=i(5529),o=i(5259).getLogger("gfx-draw-batch");class a{constructor(){this.setBuffersUsage(s.StreamDraw),this.__currDrawingParams=null,this.__staticBuffers=!1,this.__drawing=!1}makeStatic(){if(this.__validateBatch(),!this.isDrawing)throw new Error("Must call 'makeStatic()' between 'begin()' and 'end()'.");this.setBuffersUsage(this.BuffersUsage.StaticDraw),this.__staticBuffers=!0}get defaultEffect(){return null}get BuffersUsage(){return s}destroy(){}get isDestroyed(){return!1}__validateBatch(){if(this.isDestroyed)throw new Error("Can't perform this action after the batch was destroyed!")}setBuffersUsage(t){switch(t){case s.DynamicDraw:this.__buffersUsage=a._gfx._internal.gl.DYNAMIC_DRAW;break;case s.StreamDraw:this.__buffersUsage=a._gfx._internal.gl.STREAM_DRAW;break;case s.StaticDraw:this.__buffersUsage=a._gfx._internal.gl.STATIC_DRAW;break;default:this.__buffersUsage=a._gfx._internal.gl.DYNAMIC_DRAW,o.warn("Illegal buffers usage value: "+t)}}get isDrawing(){return this.__drawing}__validateDrawing(t){if(!this.isDrawing)throw new Error("Can't perform this action without calling 'begin()' first!");if(t&&this.__staticBuffers)throw new Error("Can't perform this action after batch has turned static!")}begin(t,e,i,r){if(this.isDrawing)throw new Error("Can't call Drawing Batch 'begin' twice without calling 'end()' first!");this.__validateBatch();let s=this.__currDrawingParams&&this.__currDrawingParams.texture||null;e=e||this.defaultEffect,t=t||this.defaultBlendMode,this.__currDrawingParams={blendMode:t,effect:e,transform:i||n.identity,overrideEffectFlags:r,hasVertexColor:e.hasVertexColor,texture:s},this.__drawing=!0}endWithoutDraw(){this.__validateBatch(),this.__validateDrawing(!1),this.__staticBuffers||(this.clear(),this.__currDrawingParams=null),this.__drawing=!1}end(){this.__validateBatch(),this.__validateDrawing(!1),this._drawBatch(),this.__staticBuffers||(this.clear(),this.__currDrawingParams=null),this.__drawing=!1}present(){this._drawBatch()}clear(){if(this.__staticBuffers)throw new Error("Can't clear batch after it was turned static. You can only destroy it.")}get isStatic(){return this.__staticBuffers}get defaultBlendMode(){return r.AlphaBlend}_drawBatch(){this.__validateBatch(),this.__validateDrawing(!1);let t=this.__currDrawingParams.effect,e=a._gfx;e._internal.useEffect(t,this.__currDrawingParams.overrideEffectFlags),e._internal.setBlendMode(this.__currDrawingParams.blendMode),t.setWorldMatrix(this.__currDrawingParams.transform),e._internal.setActiveTexture(this.__currDrawingParams.texture),this._onSetEffect(t,this.__currDrawingParams.texture)}_onSetEffect(t,e){}}a._gfx=null,t.exports=a},8333:(t,e,i)=>{const{Rectangle:r}=i(3624),s=i(2544),n=i(8329),o=i(5529),a=i(4288),l=i(2069),h=i(5259).getLogger("gfx-sprite-batch"),u=new s(0,0),d=new s(0,0),c=new s(0,0),f=new s(0,0);t.exports=class extends l{constructor(t){super(),this.#u(t||500),this.__maxLinesCount=Math.floor(this._buffers.positionArray.length/6),this.__linesCount=0,this.__dirty=!1,this.onOverflow=null,this.snapPixels=!1,this.linesStrip=!1}get#d(){return l._gfx}get#c(){return l._gfx._internal.gl}#u(t){let e=this.#c;this._buffers={positionBuffer:e.createBuffer(),positionArray:new Float32Array(6*t),colorsBuffer:e.createBuffer(),colorsArray:new Float32Array(8*t),indexBuffer:e.createBuffer()};let i,r=3*t;r<=256&&(i=Uint8Array,this.__indicesType=e.UNSIGNED_BYTE),r<=65535?(i=Uint16Array,this.__indicesType=e.UNSIGNED_SHORT):(i=Uint32Array,this.__indicesType=e.UNSIGNED_INT);let s=new i(3*t);for(let t=0;t<s.length;t++)s[t]=t;function n(t){t&&(t._index=0)}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffers.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,s,e.STATIC_DRAW),n(this._buffers.positionArray),n(this._buffers.colorsArray)}clear(){super.clear(),this._buffers.positionArray._index=0,this._buffers.colorsArray._index=0,this.__linesCount=0,this.__dirty=!1}destroy(){let t=this.#c;this._buffers&&(this._buffers.positionBuffer&&t.deleteBuffer(this._buffers.positionBuffer),this._buffers.colorsBuffer&&t.deleteBuffer(this._buffers.colorsBuffer)),this._buffers=null}get isDestroyed(){return!1===Boolean(this._buffers)}get defaultEffect(){return this.#d.builtinEffects.Shapes}drawVertices(t){if(this.__validateDrawing(!0),!this.linesStrip&&t.length%2!=0)return void h.warn("Tried to push vertices that are not multiplication of 2!");let e=0,i=this._buffers.colorsArray,r=this._buffers.positionArray;for(let s of t)this.__currDrawingParams.hasVertexColor&&(i[i._index++]=s.color.r||0,i[i._index++]=s.color.g||0,i[i._index++]=s.color.b||0,i[i._index++]=s.color.a||0),r[r._index++]=s.position.x||0,r[r._index++]=s.position.y||0,r[r._index++]=s.position.z||0,(1==e++||this.linesStrip)&&(this.__linesCount++,this.__linesCount>=this.__maxLinesCount&&this._handleFullBuffer(),e=0);this.__dirty=!0}drawQuad(t,e,i,r,s,n){let o=this.#d.Sprite.build(null,t,e,void 0,i,r,s,n);this.#f(o)}drawRectangle(t,e,i,o,a){(t instanceof s||t instanceof n)&&(t=new r(0,0,t.x,t.y)),this.drawQuad(t.getCenter(),t.getSize(),e,i,o,a)}drawCircle(t,e,i,r,n){if(this.__validateDrawing(!0),void 0===i)i=24;else if(i<2)return;let o;if(r?"number"==typeof r&&(r=new s(1,r)):r=s.oneReadonly,n){let t=Math.cos(n),e=Math.sin(n);o=function(i){let r=i.x*t-i.y*e,s=i.x*e+i.y*t;return i.x=r,i.y=s,i}}const l=2*Math.PI/i;let h=new s(t.radius*Math.cos(0)*r.x,t.radius*Math.sin(0)*r.y);o&&o(h);for(let n=1;n<=i;n++){let i=new s(t.radius*Math.cos(n*l)*r.x,t.radius*Math.sin(n*l)*r.y);o&&o(i),this.linesStrip?(1===n&&this.drawVertices([new a(h.add(t.center),null,e)]),this.drawVertices([new a(i.add(t.center),null,e)])):this.drawVertices([new a(h.add(t.center),null,e),new a(i.add(t.center),null,e)]),h=i}}#f(t,e){this.__validateDrawing(!0),this.__dirty=!0;{let i=t.size.x,r=t.size.y,s=-i*t.origin.x,n=-r*t.origin.y;u.x=s,u.y=n,d.x=s+i,d.y=n,c.x=s,c.y=n+r,f.x=s+i,f.y=n+r;let l=!0;if(t.skew&&(t.skew.x&&(u.x+=t.skew.x*t.origin.y,d.x+=t.skew.x*t.origin.y,c.x-=t.skew.x*(1-t.origin.y),f.x-=t.skew.x*(1-t.origin.y),l=!1),t.skew.y&&(u.y+=t.skew.y*t.origin.x,c.y+=t.skew.y*t.origin.x,d.y-=t.skew.y*(1-t.origin.x),f.y-=t.skew.y*(1-t.origin.x),l=!1)),t.rotation){let h=Math.cos(t.rotation),_=Math.sin(t.rotation);function g(t){let e=t.x*h-t.y*_,i=t.x*_+t.y*h;t.x=e,t.y=i}g(u),g(d),g(c),g(f),l=!1}u.x+=t.position.x,u.y+=t.position.y,d.x+=t.position.x,d.y+=t.position.y,c.x+=t.position.x,c.y+=t.position.y,f.x+=t.position.x,f.y+=t.position.y,e&&!e.isIdentity&&(u.copy(void 0!==u.z?o.transformVector3(e,u):o.transformVector2(e,u)),d.copy(void 0!==d.z?o.transformVector3(e,d):o.transformVector2(e,d)),c.copy(void 0!==c.z?o.transformVector3(e,c):o.transformVector2(e,c)),f.copy(void 0!==f.z?o.transformVector3(e,f):o.transformVector2(e,f))),this.snapPixels&&(u.floorSelf(),d.floorSelf(),c.floorSelf(),f.floorSelf()),this.linesStrip?this.drawVertices([new a(u,null,t.color),new a(d,null,t.color),new a(f,null,t.color),new a(c,null,t.color),new a(u,null,t.color)]):this.drawVertices([new a(u,null,t.color),new a(d,null,t.color),new a(d,null,t.color),new a(f,null,t.color),new a(f,null,t.color),new a(c,null,t.color),new a(c,null,t.color),new a(u,null,t.color)])}}get linesInBatch(){return this.__linesCount}get maxLinesCount(){return this.__maxLinesCount}get isFull(){return this.__linesCount>=this.__maxLinesCount}_handleFullBuffer(){this.onOverflow&&this.onOverflow(),this._drawBatch(),this.clear()}_drawBatch(){let t=this.__currDrawingParams.effect,e=this.#c,i=this.#d,r=this._buffers.positionArray,s=this.__currDrawingParams.hasVertexColor?this._buffers.colorsArray:null,n=this._buffers.positionBuffer,o=this._buffers.colorsBuffer,a=this._buffers.indexBuffer,l=this.__dirty;if(r._index<=1)return;t=t||this.defaultEffect,super._drawBatch();const h=r._index/3;t.setPositionsAttribute(n,!0),l&&e.bufferData(e.ARRAY_BUFFER,r,this.__buffersUsage,0,r._index),this.__currDrawingParams.hasVertexColor&&o&&(t.setColorsAttribute(o,!0),l&&s&&e.bufferData(e.ARRAY_BUFFER,s,this.__buffersUsage,0,s._index)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.drawElements(this.linesStrip?e.LINE_STRIP:e.LINES,h,this.__indicesType,0),i._internal.drawCallsCount++,i._internal.drawShapePolygonsCount+=h/2,this.__dirty=!1,this.__staticBuffers&&(this._buffers.positionArray=this._buffers.colorsArray=null)}}},1772:(t,e,i)=>{const{Rectangle:r}=i(3624),s=i(2544),n=i(8329),o=i(5529),a=i(4288),l=i(2069),h=i(5259).getLogger("gfx-sprite-batch"),u=new s(0,0),d=new s(0,0),c=new s(0,0),f=new s(0,0);t.exports=class extends l{constructor(t){super(),this.#u(t||500),this.__maxPolyCount=Math.floor(this._buffers.positionArray.length/9),this.__polyCount=0,this.__dirty=!1,this.onOverflow=null,this.snapPixels=!1}get#d(){return l._gfx}get#c(){return l._gfx._internal.gl}#u(t){let e=this.#c;this._buffers={positionBuffer:e.createBuffer(),positionArray:new Float32Array(9*t),colorsBuffer:e.createBuffer(),colorsArray:new Float32Array(12*t),indexBuffer:e.createBuffer()};let i,r=3*t;r<=256&&(i=Uint8Array,this.__indicesType=e.UNSIGNED_BYTE),r<=65535?(i=Uint16Array,this.__indicesType=e.UNSIGNED_SHORT):(i=Uint32Array,this.__indicesType=e.UNSIGNED_INT);let s=new i(3*t);for(let t=0;t<s.length;t++)s[t]=t;function n(t){t&&(t._index=0)}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffers.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,s,e.STATIC_DRAW),n(this._buffers.positionArray),n(this._buffers.colorsArray)}clear(){super.clear(),this._buffers.positionArray._index=0,this._buffers.colorsArray._index=0,this.__polyCount=0,this.__dirty=!1}destroy(){let t=this.#c;this._buffers&&(this._buffers.positionBuffer&&t.deleteBuffer(this._buffers.positionBuffer),this._buffers.colorsBuffer&&t.deleteBuffer(this._buffers.colorsBuffer)),this._buffers=null}get isDestroyed(){return!1===Boolean(this._buffers)}get defaultEffect(){return this.#d.builtinEffects.Shapes}drawLine(t,e,i,r){r=r||1,length=t.distanceTo(e);let n=s.radiansBetween(t,e),o=r>1?new s(t.x,t.y-r/2):t,a=new s(length,r);this.drawQuad(o,a,i,n,new s(0,.5))}drawVertices(t){if(this.__validateDrawing(!0),t.length%3!=0)return void h.warn("Tried to push vertices that are not multiplication of 3!");let e=0,i=this._buffers.colorsArray,r=this._buffers.positionArray;for(let s of t)this.__currDrawingParams.hasVertexColor&&(i[i._index++]=s.color.r||0,i[i._index++]=s.color.g||0,i[i._index++]=s.color.b||0,i[i._index++]=s.color.a||0),r[r._index++]=s.position.x||0,r[r._index++]=s.position.y||0,r[r._index++]=s.position.z||0,2==e++&&(this.__polyCount++,this.__polyCount>=this.__maxPolyCount&&this._handleFullBuffer(),e=0);this.__dirty=!0}drawQuad(t,e,i,r,s,n){let o=this.#d.Sprite.build(null,t,e,void 0,i,r,s,n);this.#f(o)}addPoint(t,e){this.drawVertices([new a(t,null,e),new a(t.add(2,0),null,e),new a(t.add(0,2),null,e)])}drawRectangle(t,e,i,o){(t instanceof s||t instanceof n)&&(t=new r(0,0,t.x,t.y));let a=o?t.getPosition().addSelf(l.mul(o)):t.getCenter();o=o||s.halfReadonly;let l=t.getSize();this.drawQuad(a,l,e,i,o)}drawCircle(t,e,i,r,n,o){if(this.__validateDrawing(!0),void 0===i)i=24;else if(i<2)return;let l;if(r||(r=e),n?"number"==typeof n&&(n=new s(1,n)):n=s.oneReadonly,o){let t=Math.cos(o),e=Math.sin(o);l=function(i){let r=i.x*t-i.y*e,s=i.x*e+i.y*t;return i.x=r,i.y=s,i}}const h=2*Math.PI/i;let u=new s(t.radius*Math.cos(0)*n.x,t.radius*Math.sin(0)*n.y);l&&l(u);for(let o=1;o<=i;o++){let i=new s(t.radius*Math.cos(o*h)*n.x,t.radius*Math.sin(o*h)*n.y);l&&l(i),this.drawVertices([new a(t.center,null,e),new a(u.add(t.center),null,r),new a(i.add(t.center),null,r)]),u=i}}#f(t,e){this.__validateDrawing(!0),this.__dirty=!0;{let i=t.size.x,r=t.size.y,s=-i*t.origin.x,n=-r*t.origin.y;u.x=s,u.y=n,d.x=s+i,d.y=n,c.x=s,c.y=n+r,f.x=s+i,f.y=n+r;let l=!0;if(t.skew&&(t.skew.x&&(u.x+=t.skew.x*t.origin.y,d.x+=t.skew.x*t.origin.y,c.x-=t.skew.x*(1-t.origin.y),f.x-=t.skew.x*(1-t.origin.y),l=!1),t.skew.y&&(u.y+=t.skew.y*t.origin.x,c.y+=t.skew.y*t.origin.x,d.y-=t.skew.y*(1-t.origin.x),f.y-=t.skew.y*(1-t.origin.x),l=!1)),t.rotation){let h=Math.cos(t.rotation),_=Math.sin(t.rotation);function g(t){let e=t.x*h-t.y*_,i=t.x*_+t.y*h;t.x=e,t.y=i}g(u),g(d),g(c),g(f),l=!1}u.x+=t.position.x,u.y+=t.position.y,d.x+=t.position.x,d.y+=t.position.y,c.x+=t.position.x,c.y+=t.position.y,f.x+=t.position.x,f.y+=t.position.y,e&&!e.isIdentity&&(u.copy(void 0!==u.z?o.transformVector3(e,u):o.transformVector2(e,u)),d.copy(void 0!==d.z?o.transformVector3(e,d):o.transformVector2(e,d)),c.copy(void 0!==c.z?o.transformVector3(e,c):o.transformVector2(e,c)),f.copy(void 0!==f.z?o.transformVector3(e,f):o.transformVector2(e,f))),this.snapPixels&&(u.floorSelf(),d.floorSelf(),c.floorSelf(),f.floorSelf()),this.drawVertices([new a(u,null,t.color),new a(d,null,t.color),new a(c,null,t.color),new a(d,null,t.color),new a(c,null,t.color),new a(f,null,t.color)])}}get polygonsInBatch(){return this.__polyCount}get maxPolygonsCount(){return this.__maxPolyCount}get isFull(){return this.__polyCount>=this.__maxPolyCount}_handleFullBuffer(){this.onOverflow&&this.onOverflow(),this._drawBatch(),this.clear()}_drawBatch(){let t=this.__currDrawingParams.effect,e=this.#c,i=this.#d,r=this._buffers.positionArray,s=this.__currDrawingParams.hasVertexColor?this._buffers.colorsArray:null,n=this._buffers.positionBuffer,o=this._buffers.colorsBuffer,a=this._buffers.indexBuffer,l=this.__dirty,h=this.polygonsInBatch;0!==h&&(super._drawBatch(),t.setPositionsAttribute(n,!0),l&&e.bufferData(e.ARRAY_BUFFER,r,this.__buffersUsage,0,3*h*3),this.__currDrawingParams.hasVertexColor&&o&&(t.setColorsAttribute(o,!0),l&&s&&e.bufferData(e.ARRAY_BUFFER,s,this.__buffersUsage,0,3*h*4)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.drawElements(e.TRIANGLES,3*h,this.__indicesType,0),i._internal.drawCallsCount++,i._internal.drawShapePolygonsCount+=h,this.__dirty=!1,this.__staticBuffers&&(this._buffers.positionArray=this._buffers.colorsArray=null))}}},962:(t,e,i)=>{i(2262),i(4397);const{Rectangle:r}=i(3624),s=i(2544),n=i(8329),o=i(2069),a=i(6195),l=i(5259).getLogger("gfx-sprite-batch");t.exports=class extends a{constructor(t,e){super(t,e)}get#d(){return o._gfx}get#c(){return o._gfx._internal.gl}get defaultEffect(){return this.supportVertexColor?this.#d.builtinEffects.Sprites:this.#d.builtinEffects.SpritesNoVertexColor}drawVertices(t,e){if(this.__validateDrawing(!0),this._updateTexture(t),e.length%4!=0)return void l.warn("Tried to push vertices that are not multiplication of 4!");let i=0,r=this._buffers.colorsArray,s=this._buffers.textureArray,n=this._buffers.positionArray;for(let t of e)this.__currDrawingParams.hasVertexColor&&(r[r._index++]=t.color.r||0,r[r._index++]=t.color.g||0,r[r._index++]=t.color.b||0,r[r._index++]=t.color.a||0),s[s._index++]=t.textureCoord.x||0,s[s._index++]=t.textureCoord.y||0,n[n._index++]=t.position.x||0,n[n._index++]=t.position.y||0,n[n._index++]=t.position.z||0,3==i++&&(this.__quadsCount++,this.__quadsCount>=this.__maxQuadsCount&&this._handleFullBuffer(),i=0);this.__dirty=!0}drawQuad(t,e,i,r,s,n,o,a){let l=this.#d.Sprite.build(t,e,i,r,s,n,o,a);this.drawSprite(l)}drawSpriteGroup(t,e){let i=t.getTransform();this.drawSprite(t._sprites,i,e)}drawRectangle(t,e,i,o,a){(e instanceof s||e instanceof n)&&(e=new r(0,0,e.x,e.y));let l=a?e.getPosition().addSelf(h.mul(a)):e.getCenter();a=a||s.halfReadonly;let h=e.getSize();this.drawQuad(t,l,h,i,o)}}},7561:(t,e,i)=>{const r=i(2069),s=i(962);i(5259).getLogger("gfx-sprite-batch"),t.exports=class extends s{constructor(t,e){super(t,e,!0),this.__camera=this.#d.createCamera3D(),this.setPerspectiveCamera(),this.camera.setViewLookat()}get camera(){return this.__camera}setPerspectiveCamera(t,e,i,r){let s=this.__camera;t=t||45*Math.PI/180,e=e||this.#d.getRenderingSize().x/this.#d.getRenderingSize().y,i=i||.1,r=r||1e4,s.perspective(t,e,i,r)}get#d(){return r._gfx}get#c(){return r._gfx._internal.gl}get supportVertexColor(){return!0}get defaultEffect(){return this.#d.builtinEffects.Sprites3d}setCamera(t){this.__camera=t}_onSetEffect(t,e){this.__camera.view&&t.setViewMatrix(this.__camera.view),this.__camera&&this.#d.applyCamera(this.__camera)}}},6195:(t,e,i)=>{const{Rectangle:r}=i(3624),s=i(2544),n=i(5529),o=i(2069);i(5259).getLogger("gfx-sprite-batch");const a=new s(0,0),l=new s(0,0),h=new s(0,0),u=new s(0,0);t.exports=class extends o{constructor(t,e){super(),this.#u(t||500,e),this.__maxQuadsCount=Math.floor(this._buffers.positionArray.length/12),this.__quadsCount=0,this.__dirty=!1,this.onOverflow=null,this.snapPixels=!1,this.cullOutOfScreen=!1}get#d(){return o._gfx}get#c(){return o._gfx._internal.gl}destroy(){let t=this.#c;this._buffers&&(this._buffers.positionBuffer&&t.deleteBuffer(this._buffers.positionBuffer),this._buffers.colorsBuffer&&t.deleteBuffer(this._buffers.colorsBuffer),this._buffers.textureCoordBuffer&&t.deleteBuffer(this._buffers.textureCoordBuffer)),this._buffers=null}get isDestroyed(){return!1===Boolean(this._buffers)}#u(t,e){let i=this.#c;void 0===e&&(e=!0),this._buffers={positionBuffer:i.createBuffer(),positionArray:new Float32Array(12*t),textureCoordBuffer:i.createBuffer(),textureArray:new Float32Array(8*t),colorsBuffer:e?i.createBuffer():null,colorsArray:e?new Float32Array(16*t):null,indexBuffer:i.createBuffer()};let r,s=4*t;s<=256&&(r=Uint8Array,this.__indicesType=i.UNSIGNED_BYTE),s<=65535?(r=Uint16Array,this.__indicesType=i.UNSIGNED_SHORT):(r=Uint32Array,this.__indicesType=i.UNSIGNED_INT);let n=new r(6*t),o=0;for(let t=0;t<n.length;t+=6)n[t]=o,n[t+1]=o+1,n[t+2]=o+2,n[t+3]=o+1,n[t+4]=o+3,n[t+5]=o+2,o+=4;function a(t){t&&(t._index=0)}i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._buffers.indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,n,i.STATIC_DRAW),a(this._buffers.positionArray),a(this._buffers.textureArray),a(this._buffers.colorsArray)}clear(){super.clear(),this._buffers.positionArray&&(this._buffers.positionArray._index=0),this._buffers.textureArray&&(this._buffers.textureArray._index=0),this._buffers.colorsArray&&this.supportVertexColor&&(this._buffers.colorsArray._index=0),this.__quadsCount=0,this.__dirty=!1}_updateTexture(t){this.__currDrawingParams.texture&&this.__currDrawingParams.texture!=t&&(this._drawBatch(),this.clear(),this.__dirty=!0),this.__currDrawingParams.texture=t}get supportVertexColor(){return Boolean(this._buffers.colorsBuffer)}get defaultEffect(){return this.supportVertexColor?this.#d.builtinEffects.Sprites:this.#d.builtinEffects.SpritesNoVertexColor}drawSprite(t,e,i){this.__validateDrawing(!0),Array.isArray(t)||(t=[t]),this.__dirty=!0;let s=this._buffers.colorsArray,o=this._buffers.textureArray;const d=i||this.cullOutOfScreen&&void 0===i?this.#d._internal.getRenderingRegionInternal():null;for(let c of t){if(this._updateTexture(c.texture),this.__quadsCount++,s&&this.__currDrawingParams.hasVertexColor)if(Array.isArray(c.color)){let T=c.color[0];for(let S=0;S<4;++S){let C=c.color[S]||T;s[s._index++]=C.r,s[s._index++]=C.g,s[s._index++]=C.b,s[s._index++]=C.a,T=C}}else{let R=c.color;for(let E=0;E<4;++E)s[s._index++]=R.r,s[s._index++]=R.g,s[s._index++]=R.b,s[s._index++]=R.a}let f=c.sourceRectangle,_=c.texture.sourceRectangle;if(f){_=_||{x:0,y:0,width:0,height:0};let A=c.texture.width,B=c.texture.height,M=(f.left+_.x)/A,D=(f.right+_.x)/A,P=(f.top+_.y)/B,z=(f.bottom+_.y)/B;o[o._index++]=M,o[o._index++]=P,o[o._index++]=D,o[o._index++]=P,o[o._index++]=M,o[o._index++]=z,o[o._index++]=D,o[o._index++]=z}else if(_){let U=c.texture.sourceRectangleNormalized,k=c.texture.width,F=c.texture.height,I=U.left||_.left/k,L=U.right||_.right/k,N=U.top||_.top/F,O=U.bottom||_.bottom/F;o[o._index++]=I,o[o._index++]=N,o[o._index++]=L,o[o._index++]=N,o[o._index++]=I,o[o._index++]=O,o[o._index++]=L,o[o._index++]=O}else o[o._index++]=0,o[o._index++]=0,o[o._index++]=1,o[o._index++]=0,o[o._index++]=0,o[o._index++]=1,o[o._index++]=1,o[o._index++]=1;let g=c.size.x,m=c.size.y,p=-g*c.origin.x,x=-m*c.origin.y;a.x=p,a.y=x,l.x=p+g,l.y=x,h.x=p,h.y=x+m,u.x=p+g,u.y=x+m;let y=!0;if(c.skew&&(c.skew.x&&(a.x+=c.skew.x*c.origin.y,l.x+=c.skew.x*c.origin.y,h.x-=c.skew.x*(1-c.origin.y),u.x-=c.skew.x*(1-c.origin.y),y=!1),c.skew.y&&(a.y+=c.skew.y*c.origin.x,h.y+=c.skew.y*c.origin.x,l.y-=c.skew.y*(1-c.origin.x),u.y-=c.skew.y*(1-c.origin.x),y=!1)),c.rotation){let V=Math.cos(c.rotation),W=Math.sin(c.rotation);function j(t){let e=t.x*V-t.y*W,i=t.x*W+t.y*V;t.x=e,t.y=i}j(a),j(l),j(h),j(u),y=!1}if(a.x+=c.position.x,a.y+=c.position.y,l.x+=c.position.x,l.y+=c.position.y,h.x+=c.position.x,h.y+=c.position.y,u.x+=c.position.x,u.y+=c.position.y,e&&!e.isIdentity&&(a.copy(void 0!==a.z?n.transformVector3(e,a):n.transformVector2(e,a)),l.copy(void 0!==l.z?n.transformVector3(e,l):n.transformVector2(e,l)),h.copy(void 0!==h.z?n.transformVector3(e,h):n.transformVector2(e,h)),u.copy(void 0!==u.z?n.transformVector3(e,u):n.transformVector2(e,u))),d){let q=y?new r(a.x,a.y,u.x-a.x,u.y-a.y):r.fromPoints([a,l,h,u]);if(!d.collideRect(q))return}this.snapPixels&&(a.floorSelf(),l.floorSelf(),h.floorSelf(),u.floorSelf());let w=c.position.z||0,b=w+c.size.z||0,v=this._buffers.positionArray;v[v._index++]=a.x,v[v._index++]=a.y,v[v._index++]=w,v[v._index++]=l.x,v[v._index++]=l.y,v[v._index++]=w,v[v._index++]=h.x,v[v._index++]=h.y,v[v._index++]=b,v[v._index++]=u.x,v[v._index++]=u.y,v[v._index++]=b,this.__quadsCount>=this.__maxQuadsCount&&this._handleFullBuffer()}}get quadsInBatch(){return this.__quadsCount}get maxQuadsCount(){return this.__maxQuadsCount}get isFull(){return this.__quadsCount>=this.__maxQuadsCount}_handleFullBuffer(){this.onOverflow&&this.onOverflow(),this._drawBatch(),this.clear()}_drawBatch(){let t=this.__currDrawingParams.texture,e=this.__currDrawingParams.effect;if(!t||!t.valid)return;let i=this.__dirty,r=this.quadsInBatch;if(0===r)return;let s=this.#c,n=this.#d,o=this._buffers.positionArray,a=this._buffers.textureArray,l=this.__currDrawingParams.hasVertexColor?this._buffers.colorsArray:null,h=this._buffers.positionBuffer,u=this._buffers.textureCoordBuffer,d=this._buffers.colorsBuffer,c=this._buffers.indexBuffer;super._drawBatch(),e.setPositionsAttribute(h,!0),i&&s.bufferData(s.ARRAY_BUFFER,o,this.__buffersUsage,0,4*r*3),e.setTextureCoordsAttribute(u,!0),i&&s.bufferData(s.ARRAY_BUFFER,a,this.__buffersUsage,0,4*r*2),this.__currDrawingParams.hasVertexColor&&d&&(e.setColorsAttribute(d,!0),i&&l&&s.bufferData(s.ARRAY_BUFFER,l,this.__buffersUsage,0,4*r*4)),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c),s.drawElements(s.TRIANGLES,6*r,this.__indicesType,0),n._internal.drawCallsCount++,n._internal.drawQuadsCount+=r,this.__dirty=!1,this.__staticBuffers&&(this._buffers.positionArray=this._buffers.textureArray=this._buffers.colorsArray=null)}}},985:(t,e,i)=>{const r=i(167),s=i(1252),{Color:n}=i(3624),o=(i(1036),i(2069)),a=(i(962),i(6195)),l=i(5259).getLogger("gfx-effect");t.exports=class extends a{constructor(t){super(t,!0),this.msdfFont=!1,this.outlineWeight=0,this.outlineColor=n.black}get#d(){return o._gfx}get#c(){return o._gfx._internal.gl}get defaultEffect(){return this.msdfFont?this.#d.builtinEffects.MsdfFont:this.outlineWeight?this.#d.builtinEffects.SpritesWithOutline:this.#d.builtinEffects.Sprites}drawText(t,e){let i=t.getTransform();this.drawSprite(t._sprites,i,e)}_drawBatch(){let t=this.__currDrawingParams.texture;!this.msdfFont||t instanceof s||l.warn("Trying to render an MSDF font but using an asset that isn't an instance of 'MsdfFontTextureAsset'!"),this.msdfFont||t instanceof r||l.warn("Trying to render text sprites but using an asset that isn't an instance of 'FontTextureAsset'!");let e=this.__currDrawingParams.effect||this.defaultEffect;this.outlineWeight&&e.setOutline(this.outlineWeight,this.outlineColor);let i=this.__currDrawingParams.texture;this.__currDrawingParams.texture=t.texture,super._drawBatch(),this.__currDrawingParams.texture=i}}},8986:(t,e,i)=>{const r=i(9327),{TextureFilterModes:s}=i(5387),{TextureWrapMode:n,TextureWrapModes:o}=i(2464),a=(i(5529),i(2544),i(4397),i(5259).getLogger("gfx-effect"));let l=null;class h{constructor(){this.#_(h._gfx._internal.gl)}#_(t){let e=t.createProgram();{let i=u(this.constructor,t,this.vertexCode,t.VERTEX_SHADER);t.attachShader(e,i)}{let i=u(this.constructor,t,this.fragmentCode,t.FRAGMENT_SHADER);t.attachShader(e,i)}if(t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS))throw a.error("Error linking shader program:"),a.error(t.getProgramInfoLog(e)),new Error("Failed to link shader program.");this._gl=t,this._program=e,this.uniforms={},this._uniformBinds={},this._pendingUniformValues={},this._pendingAttributeValues={};for(let t in this.uniformTypes){let e=this._gl.getUniformLocation(this._program,t);if(-1===e)throw a.error("Could not find uniform: "+t),new Error(`Uniform named '${t}' was not found in shader code!`);let i=this.uniformTypes[t];if(!d._values.has(i.type))throw a.error("Uniform has invalid type: "+i.type),new Error(`Uniform '${t}' have illegal value type '${i.type}'!`);i.type===d.Matrix?function(t,e,i,r){t.uniforms[e]=s=>{l===t?t._gl[r](i,!1,s):t._pendingUniformValues[e]=[s]}}(this,t,e,i.type):i.type===d.Texture?function(t,e,i,r){t.uniforms[e]=(r,s)=>{if(l!==t)return void(t._pendingUniformValues[e]=[r,s]);s=s||0;const n=r._glTexture||r,o=t._gl["TEXTURE"+(s||0)];t._gl.activeTexture(o),t._gl.bindTexture(t._gl.TEXTURE_2D,n),t._gl.uniform1i(i,s||0),r.filter&&c(t._gl,r.filter),r.wrapMode&&f(t._gl,r.wrapMode)}}(this,t,e,i.type):i.type===d.Color?function(t,e,i,s){t.uniforms[e]=(n,o,a,h)=>{l===t?n instanceof r?t._gl[s](i,n.floatArray):t._gl[s](i,n,o,a,h):t._pendingUniformValues[e]=[n,o,a,h]}}(this,t,e,i.type):function(t,e,i,r){t.uniforms[e]=(s,n,o,a)=>{l===t?t._gl[r](i,s,n,o,a):t._pendingUniformValues[e]=[s,n,o,a]}}(this,t,e,i.type);let s=i.bind;s&&(this._uniformBinds[s]=t)}this.attributes={},this._attributeBinds={};for(let t in this.attributeTypes){let e=this._gl.getAttribLocation(this._program,t);if(-1===e)throw a.error("Could not find attribute: "+t),new Error(`Attribute named '${t}' was not found in shader code!`);let i=this.attributeTypes[t];!function(t,e,i,r){t.attributes[e]=s=>{l===t?s?(t._gl.bindBuffer(t._gl.ARRAY_BUFFER,s),t._gl.vertexAttribPointer(i,r.size,t._gl[r.type]||t._gl.FLOAT,r.normalize||!1,r.stride||0,r.offset||0),t._gl.enableVertexAttribArray(i)):t._gl.disableVertexAttribArray(i):t._pendingAttributeValues[e]=[s]}}(this,t,e,i);let r=i.bind;r&&(this._attributeBinds[r]=t)}this._cachedValues={}}get uniformTypes(){throw new Error("Not Implemented!")}get attributeTypes(){throw new Error("Not Implemented!")}setAsActive(t){this._gl.useProgram(this._program),(void 0!==(t=t||{}).enableDepthTest?t.enableDepthTest:this.enableDepthTest)?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),(void 0!==t.enableFaceCulling?t.enableFaceCulling:this.enableFaceCulling)?this._gl.enable(this._gl.CULL_FACE):this._gl.disable(this._gl.CULL_FACE),(void 0!==t.enableStencilTest?t.enableStencilTest:this.enableStencilTest)?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),(void 0!==t.enableDithering?t.enableDithering:this.enableDithering)?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER),this._gl.depthFunc(this._gl.LEQUAL),l=this;for(let t in this._pendingUniformValues)this.uniforms[t](...this._pendingUniformValues[t]);this._pendingUniformValues={};for(let t in this._pendingAttributeValues)this.attributes[t](...this._pendingAttributeValues[t]);this._pendingAttributeValues={},this._cachedValues={}}prepareToDrawBatch(t,e){this._cachedValues={},this.setPositionsAttribute(t.positions),this.setTextureCoordsAttribute(t.textureCoords),this.setColorsAttribute(t.colors),this.setWorldMatrix(e)}getBoundUniform(t){let e=this._uniformBinds[t];return e&&this.uniforms[e]||null}get vertexCode(){throw new Error("Not Implemented!")}get fragmentCode(){throw new Error("Not Implemented!")}get enableDepthTest(){return!1}get enableFaceCulling(){return!1}get enableStencilTest(){return!1}get enableDithering(){return!1}setTexture(t){if(t===this._cachedValues.texture)return!1;let e=this.getBoundUniform(h.UniformBinds.MainTexture);if(e){this._cachedValues.texture=t;let i=t._glTexture||t;this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,i),e(t,0);let r=this.getBoundUniform(h.UniformBinds.TextureWidth);r&&r(t.width);let s=this.getBoundUniform(h.UniformBinds.TextureHeight);return s&&s(t.height),!0}return!1}setColor(t){let e=this.getBoundUniform(h.UniformBinds.Color);if(e){if(t.equals(this._cachedValues.color))return;this._cachedValues.color=t.clone(),e(t.floatArray)}}setProjectionMatrix(t){let e=this.getBoundUniform(h.UniformBinds.Projection);if(e){if(t.equals(this._cachedValues.projection))return;this._cachedValues.projection=t.clone(),e(t.values)}}setWorldMatrix(t){let e=this.getBoundUniform(h.UniformBinds.World);e&&e(t.values)}setViewMatrix(t){let e=this.getBoundUniform(h.UniformBinds.View);e&&e(t.values)}setOutline(t,e){let i=this.getBoundUniform(h.UniformBinds.OutlineWeight);i&&i(t);let r=this.getBoundUniform(h.UniformBinds.OutlineColor);r&&r(e)}setUvNormalizationFactor(t){uniform=this.getBoundUniform(h.UniformBinds.UvNormalizationFactor),uniform&&uniform(t.x,t.y)}setPositionsAttribute(t,e){let i=this._attributeBinds[h.AttributeBinds.Position];if(i){if(!e&&t===this._cachedValues.positions)return;this._cachedValues.positions=t,this.attributes[i](t)}}setTextureCoordsAttribute(t,e){let i=this._attributeBinds[h.AttributeBinds.TextureCoords];if(i){if(!e&&t===this._cachedValues.coords)return;this._cachedValues.coords=t,this.attributes[i](t)}}get hasVertexColor(){return Boolean(this._attributeBinds[h.AttributeBinds.Colors])}setColorsAttribute(t,e){let i=this._attributeBinds[h.AttributeBinds.Colors];if(i){if(!e&&t===this._cachedValues.colors)return;this._cachedValues.colors=t,this.attributes[i](t)}}}function u(t,e,i,r){let s=e.createShader(r);if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw a.error(`Error compiling ${r===e.VERTEX_SHADER?"vertex":"fragment"} shader for effect '${t.name}':`),a.error(e.getShaderInfoLog(s)),new Error("Failed to compile a shader.");return s}const d={Texture:"texture",Matrix:"uniformMatrix4fv",Color:"uniform4fv",Float:"uniform1f",FloatArray:"uniform1fv",Int:"uniform1i",IntArray:"uniform1iv",Float2:"uniform2f",Float2Array:"uniform2fv",Int2:"uniform2i",Int2Array:"uniform2iv",Float3:"uniform3f",Float3Array:"uniform3fv",Int3:"uniform3i",Int3Array:"uniform3iv",Float4:"uniform4f",Float4Array:"uniform4fv",Int4:"uniform4i",Int4Array:"uniform4iv"};function c(t,e){if(!s._values.has(e))throw new Error("Invalid texture filter mode! Please pick a value from 'TextureFilterModes'.");let i=t[e];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i)}function f(t,e,i){if(void 0===i&&(i=e),!o._values.has(e))throw new Error("Invalid texture wrap mode! Please pick a value from 'TextureWrapModes'.");if(!o._values.has(i))throw new Error("Invalid texture wrap mode! Please pick a value from 'TextureWrapModes'.");t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[e]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[i])}Object.defineProperty(d,"_values",{value:new Set(Object.values(d)),writable:!1}),Object.freeze(d),h.UniformTypes=d,h.UniformBinds={MainTexture:"mainTexture",Color:"color",Projection:"projection",World:"world",View:"view",UvOffset:"uvOffset",UvScale:"uvScale",OutlineWeight:"outlineWeight",OutlineColor:"outlineColor",UvNormalizationFactor:"uvNormalizationFactor",TextureWidth:"textureWidth",TextureHeight:"textureHeight"},Object.freeze(h.UniformBinds),h.AttributeTypes={Byte:"BYTE",Short:"SHORT",UByte:"UNSIGNED_BYTE",UShort:"UNSIGNED_SHORT",Float:"FLOAT",HalfFloat:"HALF_FLOAT"},Object.freeze(h.AttributeTypes),h.AttributeBinds={Position:"position",TextureCoords:"uv",Colors:"color"},Object.freeze(h.AttributeBinds),h._gfx=null,t.exports=h},3020:(t,e,i)=>{t.exports={Effect:i(8986),SpritesEffect:i(1414),SpritesEffectNoVertexColor:i(4481),SpritesWithOutlineEffect:i(1484),ShapesEffect:i(1205),MsdfFontEffect:i(9069)}},9069:(t,e,i)=>{const r=i(8986);t.exports=class extends r{get vertexCode(){return"#version 300 es\nin vec3 position;\nin vec2 uv;\nin vec4 color;\n\nuniform mat4 projection;\nuniform mat4 world;\n\nout vec2 v_texCoord;\nout vec4 v_color;\n\nvoid main(void) {\n    gl_Position = projection * world * vec4(position, 1.0);\n    gl_PointSize = 1.0;\n    v_texCoord = uv;\n    v_color = color;\n}"}get fragmentCode(){return"#version 300 es\nprecision highp float;\n\nuniform sampler2D mainTexture;\n\nin vec2 v_texCoord;\nin vec4 v_color;\n\nout vec4 FragColor;\n\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n\nvoid main(void) {\n  vec3 _sample = texture(mainTexture, v_texCoord).rgb;\n  float sigDist = median(_sample.r, _sample.g, _sample.b) - 0.5;\n  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n  // float alpha = clamp((sigDist / (fwidth(sigDist) * 1.5)) + 0.5, 0.0, 1.0);\n\n  vec3 color = v_color.rgb * alpha;\n  FragColor = vec4(color, alpha) * v_color.a;\n}"}get uniformTypes(){return{[r.UniformBinds.MainTexture]:{type:r.UniformTypes.Texture,bind:r.UniformBinds.MainTexture},[r.UniformBinds.Projection]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.Projection},[r.UniformBinds.World]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.World}}}get attributeTypes(){return{[r.AttributeBinds.Position]:{size:3,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Position},[r.AttributeBinds.TextureCoords]:{size:2,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.TextureCoords},[r.AttributeBinds.Colors]:{size:4,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Colors}}}}},1205:(t,e,i)=>{const r=i(8986);t.exports=class extends r{get vertexCode(){return"\nattribute vec3 position;\nattribute vec4 color;\n\nuniform mat4 projection;\nuniform mat4 world;\n\nvarying vec4 v_color;\n\nvoid main(void) {\n    gl_Position = projection * world * vec4(position, 1.0);\n    gl_PointSize = 1.0;\n    v_color = color;\n}\n    "}get fragmentCode(){return"  \n#ifdef GL_ES\n    precision highp float;\n#endif\n\nvarying vec4 v_color;\n\nvoid main(void) {\n    gl_FragColor = v_color;\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n    "}get uniformTypes(){return{[r.UniformBinds.Projection]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.Projection},[r.UniformBinds.World]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.World},[r.UniformBinds.View]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.View}}}get attributeTypes(){return{[r.AttributeBinds.Position]:{size:3,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Position},[r.AttributeBinds.Colors]:{size:4,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Colors}}}}},1414:(t,e,i)=>{const r=i(8986);t.exports=class extends r{get vertexCode(){return"\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec4 color;\n\nuniform mat4 projection;\nuniform mat4 world;\n\nvarying vec2 v_texCoord;\nvarying vec4 v_color;\n\nvoid main(void) {\n    gl_Position = projection * world * vec4(position, 1.0);\n    gl_PointSize = 1.0;\n    v_texCoord = uv;\n    v_color = color;\n}\n    "}get fragmentCode(){return"  \n#ifdef GL_ES\n    precision highp float;\n#endif\n\nuniform sampler2D mainTexture;\n\nvarying vec2 v_texCoord;\nvarying vec4 v_color;\n\nvoid main(void) {\n    gl_FragColor = texture2D(mainTexture, v_texCoord) * v_color;\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n    "}get uniformTypes(){return{[r.UniformBinds.MainTexture]:{type:r.UniformTypes.Texture,bind:r.UniformBinds.MainTexture},[r.UniformBinds.Projection]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.Projection},[r.UniformBinds.World]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.World},[r.UniformBinds.View]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.View}}}get attributeTypes(){return{[r.AttributeBinds.Position]:{size:3,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Position},[r.AttributeBinds.TextureCoords]:{size:2,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.TextureCoords},[r.AttributeBinds.Colors]:{size:4,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Colors}}}}},7090:(t,e,i)=>{const r=i(1414);t.exports=class extends r{get enableDepthTest(){return!0}get enableFaceCulling(){return!1}get vertexCode(){return"\n          attribute vec3 position;\n          attribute vec2 uv;\n          attribute vec4 color;\n\n          uniform mat4 projection;\n          uniform mat4 view;\n          uniform mat4 world;\n\n          varying vec2 v_texCoord;\n          varying vec4 v_color;\n\n          void main(void) {\n              gl_Position = projection * view * world * vec4(position, 1.0);\n              gl_PointSize = 1.0;\n              v_texCoord = uv;\n              v_color = color;\n          }\n        "}get fragmentCode(){return"  \n          #ifdef GL_ES\n              precision highp float;\n          #endif\n\n          uniform sampler2D mainTexture;\n\n          varying vec2 v_texCoord;\n          varying vec4 v_color;\n\n          void main(void) {\n              gl_FragColor = texture2D(mainTexture, v_texCoord) * v_color;\n              if (gl_FragColor.a <= 0.0) { discard; }\n              gl_FragColor.rgb *= gl_FragColor.a;\n          }\n        "}}},4481:(t,e,i)=>{const r=i(8986);t.exports=class extends r{get vertexCode(){return"\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 projection;\nuniform mat4 world;\n\nvarying vec2 v_texCoord;\n\nvoid main(void) {\n    gl_Position = projection * world * vec4(position, 1.0);\n    gl_PointSize = 1.0;\n    v_texCoord = uv;\n}\n    "}get fragmentCode(){return"  \n#ifdef GL_ES\n    precision highp float;\n#endif\n\nuniform sampler2D mainTexture;\nvarying vec2 v_texCoord;\n\nvoid main(void) {\n    gl_FragColor = texture2D(mainTexture, v_texCoord);\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n    "}get uniformTypes(){return{[r.UniformBinds.MainTexture]:{type:r.UniformTypes.Texture,bind:r.UniformBinds.MainTexture},[r.UniformBinds.Projection]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.Projection},[r.UniformBinds.World]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.World},[r.UniformBinds.View]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.View}}}get attributeTypes(){return{[r.AttributeBinds.Position]:{size:3,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Position},[r.AttributeBinds.TextureCoords]:{size:2,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.TextureCoords}}}}},1484:(t,e,i)=>{const r=i(8986);t.exports=class extends r{get vertexCode(){return"\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec4 color;\n\nuniform vec4 outlineColor;\nuniform mat4 projection;\nuniform mat4 world;\n\nvarying vec2 v_texCoord;\nvarying vec4 v_color;\n\nvoid main(void) {\n    gl_Position = projection * world * vec4(position, 1.0);\n    gl_PointSize = 1.0;\n    v_texCoord = uv;\n    v_color = color;\n}\n    "}get fragmentCode(){return"  \n#ifdef GL_ES\n    precision highp float;\n#endif\n\nuniform sampler2D mainTexture;\nuniform float textureWidth;\nuniform float textureHeight;\nuniform vec4 outlineColor;\nuniform float outlineWeight;\n\nvarying vec2 v_texCoord;\nvarying vec4 v_color;\n\nvoid main(void) {\n    float total = 0.0;\n    float grabPixel;\n\n    float facX = (1.0 / textureWidth) * 2.0;\n    float facY = (1.0 / textureHeight) * 2.0;\n    total +=        texture2D(mainTexture, v_texCoord + vec2(-facX, -facY)).a;\n    total +=        texture2D(mainTexture, v_texCoord + vec2(facX, -facY)).a;\n    total +=        texture2D(mainTexture, v_texCoord + vec2(facX, facY)).a;\n    total +=        texture2D(mainTexture, v_texCoord + vec2(-facX, facY)).a;\n\n    total += texture2D(mainTexture, v_texCoord + vec2(0.0, -facY)).a * 2.0;\n    total += texture2D(mainTexture, v_texCoord + vec2(0.0, facY)).a * 2.0;\n    total += texture2D(mainTexture, v_texCoord + vec2(-facX, 0.0)).a * 2.0;\n    total += texture2D(mainTexture, v_texCoord + vec2(facX, 0.0)).a * 2.0;\n\n    total *= outlineWeight;\n    vec4 currColor = texture2D(mainTexture, v_texCoord);\n\n    gl_FragColor = (currColor.a >= 0.9) ? currColor : (outlineColor * vec4(1,1,1,total));\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n    "}get uniformTypes(){return{[r.UniformBinds.MainTexture]:{type:r.UniformTypes.Texture,bind:r.UniformBinds.MainTexture},[r.UniformBinds.Projection]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.Projection},[r.UniformBinds.World]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.World},[r.UniformBinds.View]:{type:r.UniformTypes.Matrix,bind:r.UniformBinds.View},[r.UniformBinds.OutlineColor]:{type:r.UniformTypes.Color,bind:r.UniformBinds.OutlineColor},[r.UniformBinds.TextureWidth]:{type:r.UniformTypes.Float,bind:r.UniformBinds.TextureWidth},[r.UniformBinds.TextureHeight]:{type:r.UniformTypes.Float,bind:r.UniformBinds.TextureHeight},[r.UniformBinds.OutlineWeight]:{type:r.UniformTypes.Float,bind:r.UniformBinds.OutlineWeight}}}get attributeTypes(){return{[r.AttributeBinds.Position]:{size:3,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Position},[r.AttributeBinds.TextureCoords]:{size:2,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.TextureCoords},[r.AttributeBinds.Colors]:{size:4,type:r.AttributeTypes.Float,normalize:!1,bind:r.AttributeBinds.Colors}}}}},4672:(t,e,i)=>{const r=i(9563),s=i(9327),{BlendModes:n}=i(3223),o=i(4731),{Effect:a,SpritesEffect:l,SpritesEffectNoVertexColor:h,MsdfFontEffect:u,ShapesEffect:d,SpritesWithOutlineEffect:c}=i(3020),f=i(2262),{TextureFilterModes:_}=i(5387),{TextureWrapModes:g}=i(2464),m=i(5529),p=i(2726),x=i(6565),y=i(1036),w=i(2544),b=(i(167),i(1252)),{TextAlignment:v,TextAlignments:T}=i(8684),S=i(9668),C=i(962),R=i(985),E=i(4288),A=i(2069),B=i(1772),M=i(8333),D=i(7090),P=i(7561),z=i(2493),U=i(8871),k=i(5259).getLogger("gfx");let F=null,I={antialias:!0,alpha:!0,depth:!1,premultipliedAlpha:!0,desynchronized:!1},L=null,N=null,O=null,V=null,W=null,j=null,q=null,H=0,X=0,G=0,$={},K=0;class Y{constructor(t){this._gfx=t}get gl(){return F}get drawQuadsCount(){return X}set drawQuadsCount(t){X=t}get drawCallsCount(){return H}set drawCallsCount(t){H=t}get drawShapePolygonsCount(){return G}set drawShapePolygonsCount(t){G=t}useEffect(t,e){null===t&&(t=this._gfx.builtinEffects.Sprites),O!==t&&(t.setAsActive(e),O=t,W&&O.setProjectionMatrix(W))}getRenderingRegionInternal(t){if(t&&$.withOffset)return $.withOffset;if(!t&&$.withoutOffset)return $.withoutOffset;if(this._gfx._viewport){let e=this._gfx._viewport.clone();return!1===t?(e.x=e.y=0,$.withoutOffset=e,e):($.withOffset=e,e)}let e=new o(0,0,(q||L).width,(q||L).height);return $.withoutOffset=$.withOffset=e,e}setTextureFilter(t){if(!_._values.has(t))throw new Error("Invalid texture filter mode! Please pick a value from 'TextureFilterModes'.");let e=F[t];F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,e),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,e)}setTextureWrapMode(t,e){if(void 0===e&&(e=t),!g._values.has(t))throw new Error("Invalid texture wrap mode! Please pick a value from 'TextureWrapModes'.");if(!g._values.has(e))throw new Error("Invalid texture wrap mode! Please pick a value from 'TextureWrapModes'.");F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F[t]),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F[e])}setActiveTexture(t){O.setTexture(t)&&(this.setTextureFilter(t.filter||this._gfx.defaultTextureFilter),this.setTextureWrapMode(t.wrapMode||this._gfx.defaultTextureWrapMode))}setBlendMode(t){if(N!==t){var e=F;switch(t){case n.AlphaBlend:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.Opaque:e.disable(e.BLEND);break;case n.Additive:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE);break;case n.Multiply:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.Screen:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.Subtract:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE),e.blendEquationSeparate(e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD);break;case n.Invert:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE_MINUS_DST_COLOR,e.ZERO),e.blendFuncSeparate(e.ONE_MINUS_DST_COLOR,e.ZERO,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.Overlay:e.enable(e.BLEND),e.MAX?(e.blendEquation(e.MAX),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE));break;case n.Darken:e.enable(e.BLEND),e.blendEquation(e.MIN),e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.DestIn:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_ALPHA);break;case n.DestOut:e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_ALPHA);break;default:throw new Error(`Unknown blend mode '${t}'!`)}N=t}}}t.exports=new class extends r{constructor(){super(),this.builtinEffects={},this.defaultTextureFilter=_.Nearest,this.defaultTextureWrapMode=g.Clamp,this.whiteTexture=null,this._internal=new Y(this),A._gfx=this,a._gfx=this}get webglVersion(){return K}get maxLineSegments(){return 512}setContextAttributes(t){if(F)throw new Error("Can't call setContextAttributes() after gfx was initialized!");for(let e in t)I[e]=t[e]}setCanvas(t){if(F)throw new Error("Can't call setCanvas() after gfx was initialized!");L=t}get canvas(){return L}get DrawBatch(){return A}get SpriteBatch(){return C}get SpriteBatch3D(){return P}get TextSpriteBatch(){return R}get ShapesBatch(){return B}get LinesBatch(){return M}get Effect(){return a}get SpritesEffect(){return l}get SpritesEffectNoVertexColor(){return h}get ShapesEffect(){return d}get Sprites3dEffect(){return D}get MsdfFontEffect(){return u}get Sprite(){return x}get SpritesGroup(){return y}get Matrix(){return m}get Vertex(){return E}get TextAlignments(){return T}createCamera(t){let e=new p(this);return t&&(e.viewport=this.getRenderingRegion()),e}createCamera3D(t){let e=new U(this);return t&&(e.viewport=this.getRenderingRegion()),e}setCameraOrthographic(t){let e=this.createCamera();return e.orthographicOffset(t),this.applyCamera(e),e}maximizeCanvasSize(t,e){let i=0,r=0;if(t){let t=L.parentElement;i=t.clientWidth-L.offsetLeft,r=t.clientHeight-L.offsetTop}else i=window.innerWidth,r=window.innerHeight,L.style.left="0px",L.style.top="0px";e||(i%2!=0&&i++,r%2!=0&&r++),L.width===i&&L.height===r||this.setResolution(i,r,!0)}setRenderTarget(t,e){if(this.#g(),null===t)return q=null,F.bindFramebuffer(F.FRAMEBUFFER,null),void(e||this.resetCamera());Array.isArray(t)||(t=[t]),F.bindFramebuffer(F.FRAMEBUFFER,j);var i=[];for(let e=0;e<t.length;++e){const r=F["COLOR_ATTACHMENT"+e];F.framebufferTexture2D(F.FRAMEBUFFER,r,F.TEXTURE_2D,t[e]._glTexture,0),0===e&&(q=t[e]),i.push(r)}F.drawBuffers(i),e||this.resetCamera()}setResolution(t,e,i){L.width=t,L.height=e,t%2==0&&e%2==0||k.warn("Resolution to set is not even numbers; This might cause minor artefacts when using texture atlases. Consider using even numbers instead."),i&&(L.style.width=t+"px",L.style.height=e+"px"),F.viewport(0,0,t,e),this.resetCamera()}resetCamera(){V=this.createCamera();let t=this.getRenderingSize();V.orthographic(new o(0,0,t.x,t.y)),this.applyCamera(V)}applyCamera(t){this._viewport=t.viewport;let e=this.#m(!0);F.viewport(e.x,e.y,e.width,e.height),W=t.projection.clone(),O&&O.setProjectionMatrix(W),this.#g()}#m(t){return this._internal.getRenderingRegionInternal(t)}#g(){$.withoutOffset=$.withOffset=null}getRenderingRegion(t){return this.#m(t).clone()}getRenderingSize(){return this.#m().getSize()}getCanvasSize(){return new w(L.width,L.height)}setup(){return new Promise((async(t,e)=>{if(k.info("Setup gfx manager.."),L||(L=document.createElement("canvas")),F=L.getContext("webgl2",I),K=2,F||(k.warn("Failed to init WebGL2, attempt fallback to WebGL1."),F=L.getContext("webgl",I),K=1),!F)return K=0,k.error("Can't get WebGL context!"),e("Failed to get WebGL context from canvas!");this.builtinEffects.Sprites=new l,this.builtinEffects.SpritesWithOutline=new c,this.builtinEffects.SpritesNoVertexColor=new h,this.builtinEffects.MsdfFont=new u,this.builtinEffects.Shapes=new d,this.builtinEffects.Sprites3d=new D,f._setWebGl(F),z._setWebGl(F),j=F.createFramebuffer();let i=new Image;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",await new Promise(((t,e)=>{i.onload=t})),this.whiteTexture=new f("__runtime_white_pixel__"),this.whiteTexture.fromImage(i),V=this.createCamera(),this.applyCamera(V),t()}))}buildText(t,e,i,r,n,o,a){if("string"!=typeof e&&(e=""+e),!t||!t.valid)throw new Error("Font texture is invalid!");n=n||T.Left,r=r||s.black,i=i||t.fontSize,a=a||w.one();let l=i/t.fontSize,h=new w(0,0),u=[],d=0;function c(){let e=0;switch(n){case T.Right:e=-d;break;case T.Center:e=-d/2}if(0!=e)for(let t=0;t<u.length;++t)u[t].position.x+=e;h.x=0,h.y+=t.lineHeight*l*a.y,u=[],d=0}let f=new y;for(let i=0;i<e.length;++i){let n=e[i],o=t.getSourceRect(n);if("\n"===n){c();continue}let _=new w(o.width*l,o.height*l);if(" "!==n){let e=new x(t);e.sourceRectangle=o,e.size=_;let i=t.getPositionOffset(n);if(t instanceof b?e.position.copy(h).addSelf(i.mul(.5*l)):e.position.copy(h).addSelf(i.mul(l)),e.origin.set(.5,.5),r instanceof s)e.color.copy(r);else{e.color=[];for(let t of r)e.color.push(t.clone())}e.origin.x=0,f.add(e),u.push(e)}let g=t.getXAdvance(n)*l*a.x;d+=g,h.x+=g}return c(),o&&f.position.set(o.x,o.y),f}centerCanvas(){let t=L,e=t.parentElement,i=Math.min(e.clientWidth,window.innerWidth),r=Math.min(e.clientHeight,window.innerHeight);t.style.left=Math.round(i/2-t.clientWidth/2)+"px",t.style.top=Math.round(r/2-t.clientHeight/2)+"px",t.style.display="block",t.style.position="relative"}inScreen(t){let e=this.#m();if(t instanceof S)return e.collideCircle(t);if(t instanceof w)return e.containsVector(t);if(t instanceof o)return e.collideRect(t);if(t instanceof Line)return e.collideLine(t);throw new Error("Unknown shape type to check!")}centerCamera(t,e){let i=(e?this.getCanvasSize():this.getRenderingSize()).mul(.5),r=t.sub(i);this.setCameraOrthographic(r)}get BlendModes(){return n}get TextureWrapModes(){return g}get TextureFilterModes(){return _}get drawCallsCount(){return H}get quadsDrawCount(){return X}get shapePolygonsDrawCount(){return G}clear(t){t=t||s.black,F.clearColor(t.r,t.g,t.b,t.a),F.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT)}clearDepth(t){F.clearDepth(void 0!==t?t:1)}startFrame(){N=null,H=0,X=0,G=0,this.#g()}endFrame(){}destroy(){k.warn("Cleaning up WebGL is not supported yet!")}}},7565:(t,e,i)=>{t.exports=i(4672)},6565:(t,e,i)=>{i(2262),i(4397);const r=i(9327),s=i(4731),n=i(2544);i(8329);class o{constructor(t,e){this.texture=t,this.position=n.zero(),this.size=new n(100,100),this.sourceRectangle=e||null,this.rotation=0,this.origin=new n(.5,.5),this.skew=null,this.color=r.white}setToSourceRectangleSize(){return this.size.copy(this.sourceRectangle.getSize()),this}setToTextureSize(){return this.size.copy(this.texture.getSize()),this}static build(t,e,i,r,s,a,l,h){let u=new o(t,r);return u.position=e,u.size="number"==typeof i?new n(i,i):i,s&&(u.color=s),a&&(u.rotation=a),l&&(u.origin=l),h&&(u.skew=h),u}setSourceFromSpritesheet(t,e,i,r,n){if(0===t.width||0===t.height)throw new Error("Texture has illegal size or is not fully loaded yet!");r=r||0;let o=t.width/i.x,a=t.height/i.y,l=o*e.x+r,h=a*e.y+r;o-=2*r,a-=2*r,(n||void 0===n)&&this.size.set(o,a),this.sourceRectangle?this.sourceRectangle.set(l,h,o,a):this.sourceRectangle=new s(l,h,o,a)}clone(){let t=this.sourceRectangle?this.sourceRectangle.clone():void 0,e=new o(this.texture,t);return e.position=this.position.clone(),e.size=this.size.clone(),e.rotation=this.rotation||0,e.origin=this.origin?this.origin.clone():null,e.color=this.color?this.color.clone():null,e.skew=this.skew?this.skew.clone():null,e}get flipX(){return this.size.x<0}set flipX(t){return void 0===t&&(t=!this.flipX),this.size.x=Math.abs(this.size.x)*(t?-1:1),t}get flipY(){return this.size.y<0}set flipY(t){return void 0===t&&(t=!this.flipY),this.size.y=Math.abs(this.size.y)*(t?-1:1),t}}t.exports=o},1036:(t,e,i)=>{i(9327);const r=i(2544),s=i(5529);i(6565),t.exports=class{constructor(){this._sprites=[],this.rotation=0,this.position=new r(0,0),this.scale=new r(1,1)}forEach(t){this._sprites.forEach(t)}setColor(t){for(let e=0;e<this._sprites.length;++e)this._sprites[e].color.copy(t)}getTransform(){let t=[];return 0===this.position.x&&0===this.position.y||t.push(s.createTranslation(this.position.x,this.position.y,0)),this.rotation&&t.push(s.createRotationZ(-this.rotation)),1===this.scale.x&&1===this.scale.y||t.push(s.createScale(this.scale.x,this.scale.y)),0===t.length?null:1===t.length?t[0]:s.multiplyMany(t)}add(t){return this._sprites.push(t),t}remove(t){for(let e=0;e<this._sprites.length;++e)if(this._sprites[e]===t)return void this._sprites.splice(e,1)}shift(){return this._sprites.shift()}sort(t){this._sprites.sort(t)}get count(){return this._sprites.length}}},8684:t=>{const e={Left:"left",Right:"right",Center:"center"};Object.freeze(e),t.exports={TextAlignments:e}},5387:t=>{const e={Nearest:"NEAREST",Linear:"LINEAR",NearestMipmapNearest:"NEAREST_MIPMAP_NEAREST",LinearMipmapNearest:"LINEAR_MIPMAP_NEAREST",NearestMipmapLinear:"NEAREST_MIPMAP_LINEAR",LinearMipmapLinear:"LINEAR_MIPMAP_LINEAR"};Object.defineProperty(e,"_values",{value:new Set(Object.values(e)),writable:!1}),Object.freeze(e),t.exports={TextureFilterModes:e}},2464:t=>{const e={Clamp:"CLAMP_TO_EDGE",Repeat:"REPEAT",RepeatMirrored:"MIRRORED_REPEAT"};Object.defineProperty(e,"_values",{value:new Set(Object.values(e)),writable:!1}),Object.freeze(e),t.exports={TextureWrapModes:e}},4288:(t,e,i)=>{const{Vector2:r,Color:s}=i(3624);t.exports=class{constructor(t,e,i){this.position=t||r.zero(),this.textureCoord=e||r.zero(),this.color=i||s.white}setPosition(t){return this.position=t.clone(),this}setTextureCoords(t){return this.textureCoord=t.clone(),this}setColor(t){return this.color=t.clone(),this}}},8138:(t,e,i)=>{i.g.Shaku=i(6954),t.exports=i.g.Shaku},791:(t,e,i)=>{const r=i(2544);class s{constructor(t,e,i,r){this.bottom=Boolean(t),this.right=Boolean(e),this.left=Boolean(i),this.top=Boolean(r)}}class n{constructor(t,e,i){this.left=Boolean(t),this.right=Boolean(e),this.center=Boolean(i)}}class o{constructor(t,e,i,r){this.topLeft=Boolean(t),this.topRight=Boolean(e),this.bottomLeft=Boolean(i),this.bottomRight=Boolean(r)}}t.exports=class{constructor(t){this.id=t.id,this._buttonsDown=[];for(let i=0;i<t.buttons.length;++i)this._buttonsDown[i]="object"==typeof(e=t.buttons[i])?e.pressed:1===e;var e;this.axis1=new r(t.axes[0],t.axes[1]),this.axis2=new r(t.axes[2]||0,t.axes[3]||0),this.mapping=t.mapping,this.isMapped=!1,"standard"===this.mapping&&(this.leftStick=this.axis1,this.rightStick=this.axis2,this.leftStickPressed=this._buttonsDown[10],this.rightStickPressed=this._buttonsDown[11],this.rightButtons=new s(this._buttonsDown[0],this._buttonsDown[1],this._buttonsDown[2],this._buttonsDown[3]),this.leftButtons=new s(this._buttonsDown[13],this._buttonsDown[15],this._buttonsDown[14],this._buttonsDown[12]),this.centerButtons=new n(this._buttonsDown[8],this._buttonsDown[9],this._buttonsDown[16]),this.frontButtons=new o(this._buttonsDown[4],this._buttonsDown[5],this._buttonsDown[6],this._buttonsDown[7]),this.isMapped=!0),Object.freeze(this)}button(t){return this._buttonsDown[t]}get buttonsCount(){return this._buttonsDown.length}}},8734:(t,e,i)=>{t.exports=i(9896)},9896:(t,e,i)=>{const r=i(9563),s=i(2544),{MouseButton:n,MouseButtons:o,KeyboardKey:a,KeyboardKeys:l}=i(4871),h=i(791),u=i(5259).getLogger("input");function d(){return(new Date).getTime()}const c="touch";t.exports=new class extends r{constructor(){super(),this._callbacks=null,this._targetElement=window,this.preventDefaults=!1,this.disableMouseWheelAutomaticScrolling=!0,this.disableContextMenu=!0,this.delegateTouchInputToMouse=!0,this.delegateGamepadInputToKeys=!0,this.resetOnFocusLoss=!0,this.defaultDoublePressInterval=250,this.#p()}get MouseButtons(){return o}get KeyboardKeys(){return l}get TouchKeyCode(){return c}setup(){return new Promise(((t,e)=>{if(u.info("Setup input manager.."),"function"==typeof this._targetElement&&(this._targetElement=this._targetElement(),!this._targetElement))throw new Error("Input target element was set to be a method, but the returned value was invalid!");let i=this._targetElement;-1!==i.tabIndex&&void 0!==i.tabIndex||(i.tabIndex=1e3),window.setTimeout((()=>i.focus()),0);var r=this;for(var s in this._callbacks={mousedown:function(t){r._onMouseDown(t),this.preventDefaults&&t.preventDefault()},mouseup:function(t){r._onMouseUp(t),this.preventDefaults&&t.preventDefault()},mousemove:function(t){r._onMouseMove(t),this.preventDefaults&&t.preventDefault()},keydown:function(t){r._onKeyDown(t),this.preventDefaults&&t.preventDefault()},keyup:function(t){r._onKeyUp(t),this.preventDefaults&&t.preventDefault()},blur:function(t){r._onBlur(t),this.preventDefaults&&t.preventDefault()},wheel:function(t){r._onMouseWheel(t),this.preventDefaults&&t.preventDefault()},touchstart:function(t){r._onTouchStart(t),this.preventDefaults&&t.preventDefault()},touchend:function(t){r._onTouchEnd(t),this.preventDefaults&&t.preventDefault()},touchmove:function(t){r._onTouchMove(t),this.preventDefaults&&t.preventDefault()},contextmenu:function(t){r.disableContextMenu&&t.preventDefault()}},this.#p(),this._callbacks)i.addEventListener(s,this._callbacks[s],!1);i!==window&&(window.addEventListener("mouseup",this._callbacks.mouseup,!1),window.addEventListener("touchend",this._callbacks.touchend,!1)),this._customKeys=new Set,t()}))}startFrame(){const t=this._gamepadsData||[],e=(this._defaultGamepad||{id:"null"}).id;this._gamepadsData=navigator.getGamepads(),this._defaultGamepad=null;let i=0;for(let e of this._gamepadsData){let r=(e||{id:"null"}).id,s=(t[i]||{id:"null"}).id;r!==s&&("null"!==r?u.info(`Gamepad ${i} connected: ${r}.`):"null"===r&&u.info(`Gamepad ${i} disconnected: ${s}.`)),e&&!this._defaultGamepad&&(this._defaultGamepad=e,this._defaultGamepadIndex=i),i++}const r=(this._defaultGamepad||{id:"null"}).id;if(r!==e&&u.info(`Default gamepad changed from '${e}' to '${r}'.`),this._queriedGamepadStates={},this.delegateGamepadInputToKeys)for(let t=0;t<4;++t){const e=this.gamepad(t);e&&e.isMapped?(this.setCustomState(`gamepad${t}_top`,e.leftButtons.top),this.setCustomState(`gamepad${t}_bottom`,e.leftButtons.bottom),this.setCustomState(`gamepad${t}_left`,e.leftButtons.left),this.setCustomState(`gamepad${t}_right`,e.leftButtons.right),this.setCustomState(`gamepad${t}_y`,e.rightButtons.top),this.setCustomState(`gamepad${t}_a`,e.rightButtons.bottom),this.setCustomState(`gamepad${t}_x`,e.rightButtons.left),this.setCustomState(`gamepad${t}_b`,e.rightButtons.right),this.setCustomState(`gamepad${t}_frontTopLeft`,e.frontButtons.topLeft),this.setCustomState(`gamepad${t}_frontTopRight`,e.frontButtons.topRight),this.setCustomState(`gamepad${t}_frontBottomLeft`,e.frontButtons.bottomLeft),this.setCustomState(`gamepad${t}_frontBottomRight`,e.frontButtons.bottomRight),this.setCustomState(`gamepad${t}_leftStickUp`,e.leftStick.y<-.8),this.setCustomState(`gamepad${t}_leftStickDown`,e.leftStick.y>.8),this.setCustomState(`gamepad${t}_leftStickLeft`,e.leftStick.x<-.8),this.setCustomState(`gamepad${t}_leftStickRight`,e.leftStick.x>.8),this.setCustomState(`gamepad${t}_rightStickUp`,e.rightStick.y<-.8),this.setCustomState(`gamepad${t}_rightStickDown`,e.rightStick.y>.8),this.setCustomState(`gamepad${t}_rightStickLeft`,e.rightStick.x<-.8),this.setCustomState(`gamepad${t}_rightStickRight`,e.rightStick.x>.8)):(this.setCustomState(`gamepad${t}_top`,!1),this.setCustomState(`gamepad${t}_bottom`,!1),this.setCustomState(`gamepad${t}_left`,!1),this.setCustomState(`gamepad${t}_right`,!1),this.setCustomState(`gamepad${t}_y`,!1),this.setCustomState(`gamepad${t}_a`,!1),this.setCustomState(`gamepad${t}_x`,!1),this.setCustomState(`gamepad${t}_b`,!1),this.setCustomState(`gamepad${t}_frontTopLeft`,!1),this.setCustomState(`gamepad${t}_frontTopRight`,!1),this.setCustomState(`gamepad${t}_frontBottomLeft`,!1),this.setCustomState(`gamepad${t}_frontBottomRight`,!1),this.setCustomState(`gamepad${t}_leftStickUp`,!1),this.setCustomState(`gamepad${t}_leftStickDown`,!1),this.setCustomState(`gamepad${t}_leftStickLeft`,!1),this.setCustomState(`gamepad${t}_leftStickRight`,!1),this.setCustomState(`gamepad${t}_rightStickUp`,!1),this.setCustomState(`gamepad${t}_rightStickDown`,!1),this.setCustomState(`gamepad${t}_rightStickLeft`,!1),this.setCustomState(`gamepad${t}_rightStickRight`,!1))}}destroy(){if(this._callbacks){let e=this._targetElement;for(var t in this._callbacks)e.removeEventListener(t,this._callbacks[t]);e!==window&&(window.removeEventListener("mouseup",this._callbacks.mouseup,!1),window.removeEventListener("touchend",this._callbacks.touchend,!1)),this._callbacks=null}}setTargetElement(t){if(this._callbacks)throw new Error("'setTargetElement() must be called before initializing the input manager!");this._targetElement=t}#p(t){t||(this._mousePos=new s,this._mousePrevPos=new s),this._mouseState={},this._mouseWheel=0,t||(this._touchPosition=new s),this._isTouching=!1,this._touchStarted=!1,this._touchEnded=!1,this._keyboardState={},this._keyboardPrevState={},this._keyboardPressed={},this._keyboardReleased={},this._mousePressed={},this._mouseReleased={},this._customStates={},this._customPressed={},this._customReleased={},this._lastCustomReleasedTime={},this._lastCustomPressedTime={},this._prevLastCustomReleasedTime={},this._prevLastCustomPressedTime={},this._lastMouseReleasedTime={},this._lastKeyReleasedTime={},this._lastTouchReleasedTime=0,this._lastMousePressedTime={},this._lastKeyPressedTime={},this._lastTouchPressedTime=0,this._prevLastMouseReleasedTime={},this._prevLastKeyReleasedTime={},this._prevLastTouchReleasedTime=0,this._prevLastMousePressedTime={},this._prevLastKeyPressedTime={},this._prevLastTouchPressedTime=0,this._defaultGamepad=null,this._gamepadsData=[],this._queriedGamepadStates={}}gamepad(t){null==t&&(t=this._defaultGamepadIndex);let e=this._queriedGamepadStates[t];if(!e){const i=this._gamepadsData[t];if(!i)return null;this._queriedGamepadStates[t]=e=new h(i)}return e}gamepadId(t){return this.gamepadIds()[t||0]||null}gamepadIds(){let t=[];for(let e of this._gamepadsData)e&&t.push(e.id);return t}get touchPosition(){return this._touchPosition.clone()}get touching(){return this._isTouching}get touchStarted(){return this._touchStarted}get touchEnded(){return this._touchEnded}setCustomState(t,e){if(null===e)return this._customKeys.delete(t),delete this._customPressed[t],delete this._customReleased[t],void delete this._customStates[t];this._customKeys.add(t),e=Boolean(e);const i=Boolean(this._customStates[t]);this._customStates[t]=e,void 0===this._customPressed[t]&&(this._customPressed[t]=!1),void 0===this._customReleased[t]&&(this._customReleased[t]=!1),!i&&e&&(this._customPressed[t]=!0,this._prevLastCustomPressedTime[t]=this._lastCustomPressedTime[t],this._lastCustomPressedTime[t]=d()),i&&!e&&(this._customReleased[t]=!0,this._prevLastCustomReleasedTime[t]=this._lastCustomReleasedTime[t],this._lastCustomReleasedTime[t]=d())}get mousePosition(){return this._mousePos.clone()}get prevMousePosition(){return(this._mousePrevPos||this._mousePos).clone()}get mouseDelta(){return this._mousePrevPos?new s(this._mousePos.x-this._mousePrevPos.x,this._mousePos.y-this._mousePrevPos.y):s.zero()}get mouseMoving(){return this._mousePrevPos&&!this._mousePrevPos.equals(this._mousePos)}mousePressed(t=0){if(void 0===t)throw new Error("Invalid button code!");return Boolean(this._mousePressed[t])}mouseDown(t=0){if(void 0===t)throw new Error("Invalid button code!");return Boolean(this._mouseState[t])}mouseUp(t=0){if(void 0===t)throw new Error("Invalid button code!");return Boolean(!this.mouseDown(t))}mouseReleased(t=0){if(void 0===t)throw new Error("Invalid button code!");return Boolean(this._mouseReleased[t])}keyDown(t){if(void 0===t)throw new Error("Invalid key code!");return Boolean(this._keyboardState[t])}keyUp(t){if(void 0===t)throw new Error("Invalid key code!");return Boolean(!this.keyDown(t))}keyReleased(t){if(void 0===t)throw new Error("Invalid key code!");return Boolean(this._keyboardReleased[t])}keyPressed(t){if(void 0===t)throw new Error("Invalid key code!");return Boolean(this._keyboardPressed[t])}get shiftDown(){return Boolean(this.keyDown(this.KeyboardKeys.shift))}get ctrlDown(){return Boolean(this.keyDown(this.KeyboardKeys.ctrl))}get altDown(){return Boolean(this.keyDown(this.KeyboardKeys.alt))}get anyKeyPressed(){return 0!==Object.keys(this._keyboardPressed).length}get anyKeyDown(){for(var t in this._keyboardState)if(this._keyboardState[t])return!0;return!1}get anyMouseButtonPressed(){return 0!==Object.keys(this._mousePressed).length}get anyMouseButtonDown(){for(var t in this._mouseState)if(this._mouseState[t])return!0;return!1}#x(t,e,i,r,s){const n=s[t=String(t)];if(void 0!==n)return n;if(this._customKeys.has(t))return!1;if(t===c)return r;if(0===t.indexOf("mouse_")){const i=t.split("_")[1],r=this.MouseButtons[i];if(void 0===r)throw new Error("Unknown mouse button: "+t);return e.call(this,r)}if(isNaN(parseInt(t))||1!==t.length||(t="n"+t),void 0===this.KeyboardKeys[t])throw new Error("Unknown keyboard key: "+t);return i.call(this,this.KeyboardKeys[t])}down(t){Array.isArray(t)||(t=[t]);for(let e of t)if(Boolean(this.#x(e,this.mouseDown,this.keyDown,this.touching,this._customStates)))return!0;return!1}released(t){Array.isArray(t)||(t=[t]);for(let e of t)if(Boolean(this.#x(e,this.mouseReleased,this.keyReleased,this.touchEnded,this._customReleased)))return!0;return!1}pressed(t){Array.isArray(t)||(t=[t]);for(let e of t)if(Boolean(this.#x(e,this.mousePressed,this.keyPressed,this.touchStarted,this._customPressed)))return!0;return!1}lastReleaseTime(t){if(Array.isArray(t))throw new Error("Array not supported in 'lastReleaseTime'!");return this.#x(t,(t=>this._lastMouseReleasedTime[t]),(t=>this._lastKeyReleasedTime[t]),this._lastTouchReleasedTime,this._prevLastCustomReleasedTime)||0}lastPressTime(t){if(Array.isArray(t))throw new Error("Array not supported in 'lastPressTime'!");return this.#x(t,(t=>this._lastMousePressedTime[t]),(t=>this._lastKeyPressedTime[t]),this._lastTouchPressedTime,this._prevLastCustomPressedTime)||0}doublePressed(t,e){e=e||this.defaultDoublePressInterval;let i=d();Array.isArray(t)||(t=[t]);for(let r of t)if(this.pressed(r)){let t=this.#x(r,(t=>this._prevLastMousePressedTime[t]),(t=>this._prevLastKeyPressedTime[t]),this._prevLastTouchPressedTime,this._prevLastCustomPressedTime);if(i-t<=e)return!0}return!1}doubleReleased(t,e){e=e||this.defaultDoublePressInterval;let i=d();Array.isArray(t)||(t=[t]);for(let r of t)if(this.released(r)){let t=this.#x(r,(t=>this._prevLastMousePressedTime[t]),(t=>this._prevLastKeyPressedTime[t]),this._prevLastTouchPressedTime,this._prevLastCustomPressedTime);if(i-t<=e)return!0}return!1}get mouseWheelSign(){return Math.sign(this._mouseWheel)}get mouseWheel(){return this._mouseWheel}endFrame(){this._mousePrevPos=this._mousePos.clone(),this._keyboardPressed={},this._keyboardReleased={},this._mousePressed={},this._mouseReleased={},this._customPressed={},this._customReleased={},this._touchStarted=!1,this._touchEnded=!1,this._mouseWheel=0}#y(t){return void 0!==(t=this._getEvent(t)).keyCode?t.keyCode:t.key.charCodeAt(0)}_onBlur(t){this.resetOnFocusLoss&&this.#p(!0)}_onMouseWheel(t){this._mouseWheel=t.deltaY}_onKeyDown(t){var e=this.#y(t);this._keyboardState[e]||(this._keyboardPressed[e]=!0,this._prevLastKeyPressedTime[e]=this._lastKeyPressedTime[e],this._lastKeyPressedTime[e]=d()),this._keyboardState[e]=!0}_onKeyUp(t){var e=this.#y(t)||0;this._keyboardState[e]=!1,this._keyboardReleased[e]=!0,this._prevLastKeyReleasedTime[e]=this._lastKeyReleasedTime[e],this._lastKeyReleasedTime[e]=d()}_getTouchEventPosition(t){var e=t.changedTouches||t.touches;if(e&&e.length){var i=e[0],r=i.pageX||i.offsetX||i.clientX,n=i.pageY||i.offsetY||i.clientY;return new s(r,n)}return null}_onTouchStart(t){let e=this._getTouchEventPosition(t);e&&this.delegateTouchInputToMouse&&(this._mousePos.x=e.x,this._mousePos.y=e.y,this._normalizeMousePos()),this._isTouching=!0,this._touchStarted=!0,this._prevLastTouchPressedTime=this._lastTouchPressedTime,this._lastTouchPressedTime=d(),this.delegateTouchInputToMouse&&this._mouseButtonDown(this.MouseButtons.left)}_onTouchEnd(t){let e=this._getTouchEventPosition(t);e&&(this._touchPosition.copy(e),this.delegateTouchInputToMouse&&(this._mousePos.x=e.x,this._mousePos.y=e.y,this._normalizeMousePos())),this._isTouching=!1,this._touchEnded=!0,this._prevLastTouchReleasedTime=this._lastTouchReleasedTime,this._lastTouchReleasedTime=d(),this.delegateTouchInputToMouse&&this._mouseButtonUp(this.MouseButtons.left)}_onTouchMove(t){let e=this._getTouchEventPosition(t);e&&(this._touchPosition.copy(e),this.delegateTouchInputToMouse&&(this._mousePos.x=e.x,this._mousePos.y=e.y,this._normalizeMousePos())),this._isTouching=!0}_onMouseDown(t){t=this._getEvent(t),this.disableMouseWheelAutomaticScrolling&&t.button===this.MouseButtons.middle&&t.preventDefault(),this._mouseButtonDown(t.button)}_onMouseUp(t){t=this._getEvent(t),this._mouseButtonUp(t.button)}_mouseButtonDown(t){this._mouseState[t]=!0,this._mousePressed[t]=!0,this._prevLastMousePressedTime[t]=this._lastMousePressedTime[t],this._lastMousePressedTime[t]=d()}_mouseButtonUp(t){this._mouseState[t]=!1,this._mouseReleased[t]=!0,this._prevLastMouseReleasedTime[t]=this._lastMouseReleasedTime[t],this._lastMouseReleasedTime[t]=d()}_onMouseMove(t){var e=(t=this._getEvent(t)).clientX;void 0===e&&(e=t.x),void 0===e&&(e=t.offsetX),void 0===e&&(e=t.pageX);var i=t.clientY;void 0===i&&(i=t.y),void 0===i&&(i=t.offsetY),void 0===i&&(i=t.pageY),void 0===e&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),this._mousePos.x=e,this._mousePos.y=i,this._normalizeMousePos()}_normalizeMousePos(){if(this._targetElement&&this._targetElement.getBoundingClientRect){var t=this._targetElement.getBoundingClientRect();this._mousePos.x-=t.left,this._mousePos.y-=t.top}this._mousePos.roundSelf()}_getEvent(t){return t||window.event}}},4871:t=>{t.exports={KeyboardKeys:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,break:19,caps_lock:20,escape:27,page_up:33,page_down:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,space:32,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scroll_lock:145,semicolon:186,equal_sign:187,plus:187,comma:188,dash:189,minus:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},MouseButtons:{left:0,middle:1,right:2}}},5259:t=>{var e=console,i="Shaku";class r{constructor(t){this._nameHeader=("["+i+"]["+t+"]").padEnd(25," "),this._throwErrors=!1}trace(t){e.trace(this._nameHeader,t)}debug(t){e.debug(this._nameHeader,t)}info(t){e.info(this._nameHeader,t)}warn(t){if(e.warn(this._nameHeader,t),this._throwErrors)throw new Error(t)}error(t){if(e.error(this._nameHeader,t),this._throwErrors)throw new Error(t)}throwErrorOnWarnings(t){this._throwErrors=Boolean(t)}}class s{constructor(){}trace(t){}debug(t){}info(t){}warn(t){}error(t){}}const n={},o={getLogger:function(t){return n[t]||(n[t]=new r(t)),n[t]},silent:function(){e=new s},setDrivers:function(t){e=t},setApplicationName:function(t){return i=t,this}};t.exports=o},9563:t=>{t.exports=class{setup(){throw new Error("Not Implemented!")}startFrame(){throw new Error("Not Implemented!")}endFrame(){throw new Error("Not Implemented!")}destroy(){throw new Error("Not Implemented!")}}},6871:(t,e,i)=>{t.exports=i(4939)},4939:(t,e,i)=>{const r=i(499),s=i(9563),n=i(5259).getLogger("sfx"),o=i(7244),a=i(8383);t.exports=new class extends s{constructor(){super(),this._playingSounds=null}setup(){return new Promise(((t,e)=>{n.info("Setup sfx manager.."),this._playingSounds=new Set,t()}))}startFrame(){let t=Array.from(this._playingSounds);for(let e of t)e.isPlaying||this._playingSounds.delete(e)}endFrame(){}destroy(){this.stopAll(),this.cleanup()}get SoundMixer(){return a}play(t,e,i,r){let s=this.createSound(t);s.volume=void 0!==e?e:1,void 0!==i&&(s.playbackRate=i),void 0!==r&&(s.preservesPitch=r);let n=s.play();return s.disposeWhenDone(),n}stopAll(){let t=Array.from(this._playingSounds);for(let e of t)e.stop();this._playingSounds=new Set}get playingSoundsCount(){return this._playingSounds.size}createSound(t){if(!(t instanceof r))throw new Error("Sound type must be an instance of SoundAsset!");return new o(this,t.url)}get masterVolume(){return o._masterVolume}set masterVolume(t){return o._masterVolume=t,t}}},7244:(t,e,i)=>{const r=i(5259).getLogger("sfx");class s{constructor(t,e){if(!e)throw r.error("Sound type can't be null or invalid!"),new Error("Invalid sound type to play in SoundInstance!");this._sfx=t,this._audio=new Audio(e),this._volume=1}disposeWhenDone(){this._audio.onended=()=>{this.dispose()}}dispose(){if(this._audio){try{this._audio.pause(),this._audio.remove()}catch(t){r.warn(`Error while disposing sound instance: ${t}.`)}this._audio.src="",this._audio.srcObject=null}this._audio=null}play(){if(!this._audio)throw new Error("Sound instance was already disposed!");if(this.playing)return;let t=this._audio.play();return this._sfx._playingSounds.add(this),t}get playbackRate(){return this._audio?this._audio.playbackRate:0}set playbackRate(t){return this._audio?(t<.1&&r.error("playbackRate value set is too low, value was capped to 0.1."),t>10&&r.error("playbackRate value set is too high, value was capped to 10."),this._audio.playbackRate=t,t):0}get preservesPitch(){return!!this._audio&&Boolean(this._audio.preservesPitch||this._audio.mozPreservesPitch)}set preservesPitch(t){return!!this._audio&&(this._audio.preservesPitch=this._audio.mozPreservesPitch=Boolean(t))}pause(){if(!this._audio)throw new Error("Sound instance was already disposed!");this._audio.pause()}replay(){if(!this._audio)throw new Error("Sound instance was already disposed!");return this.stop(),this.play()}stop(){if(!this._audio)throw new Error("Sound instance was already disposed!");try{return this.pause(),this.currentTime=0,!0}catch(t){return!1}}get loop(){return!!this._audio&&this._audio.loop}set loop(t){return!!this._audio&&(this._audio.loop=t,this._audio.loop)}get volume(){return this._audio?this._volume:0}set volume(t){if(!this._audio)return 0;this._volume=t;var e=t*s._masterVolume;return e<0&&(e=0),e>1&&(e=1),this._audio.volume=e,this._volume}get currentTime(){return this._audio?this._audio.currentTime:0}set currentTime(t){return this._audio?this._audio.currentTime=t:0}get duration(){return this._audio?this._audio.duration:0}get paused(){return!!this._audio&&this._audio.paused}get playing(){return!!this._audio&&!this.paused&&!this.finished}get finished(){return!!this._audio&&this._audio.ended}}s._masterVolume=1,t.exports=s},8383:(t,e,i)=>{i(7244),t.exports=class{constructor(t,e,i){this._sound1=t,this._sound2=e,this.fromSoundVolume=this._sound1?this._sound1.volume:0,this.toSoundVolume=this._sound2?this._sound2.volume:0,this.allowOverlapping=i,this.update(0)}stop(){this._sound1&&this._sound1.stop(),this._sound2&&this._sound2.stop()}get fromSound(){return this._sound1}get toSound(){return this._sound2}get progress(){return this._progress}updateDelta(t){this.update(this._progress+t)}update(t){t<=0&&(this._sound1&&(this._sound1.volume=this.fromSoundVolume),this._sound2&&(this._sound2.volume=0,this._sound2.stop()),this._progress=0),t>=1?(this._sound2&&(this._sound2.volume=this.toSoundVolume),this._sound1&&(this._sound1.volume=0,this._sound1.stop()),this._progress=1):(this._progress=t,this._sound1&&this._sound1.play(),this._sound2&&this._sound2.play(),this.allowOverlapping?(this._sound1&&(this._sound1.volume=this.fromSoundVolume*(1-t)),this._sound2&&(this._sound2.volume=this.toSoundVolume*t)):(t*=2,this._sound1&&(this._sound1.volume=Math.max(this.fromSoundVolume*(1-t),0)),this._sound2&&(this._sound2.volume=Math.max(this.toSoundVolume*(t-1),0))))}}},6954:(t,e,i)=>{const r="undefined"!=typeof window,s=(i(9563),i(5259)),n=r?i(6871):null,o=r?i(7565):null,a=r?i(8734):null,l=i(7817),h=i(6740),u=i(3624),d=i(4742),c=s.getLogger("shaku");var f=!1;let _=null,g=null,m=null,p=0,x=0,y=0,w=0,b=0,v=0,T=!1,S=!1;const C="2.2.0";t.exports=new class{constructor(){this.utils=u,this.sfx=n,this.gfx=o,this.input=a,this.assets=l,this.collision=h,this.pauseWhenNotFocused=!1,this.pause=!1,this.pauseGameTime=!1}async init(t){return new Promise((async(e,i)=>{if(f||console.log(`%c🧙 Shaku ${C}\n%c Game dev lib by Ronen Ness`,"color:orange; font-size: 18pt","color:grey; font-size: 8pt"),_)throw new Error("Already initialized!");c.info(`Initialize Shaku v${C}.`),d.reset(),_=t||(r?[l,n,o,a,h]:[l,h]);for(let t=0;t<_.length;++t)await _[t].setup();g=new d,c.info(`Shaku ${C} was initialized successfully!`),c.info("------------------------------------------------"),e()}))}destroy(){if(!_)throw new Error("Not initialized!");for(let t=0;t<_.length;++t)_[t].destroy()}isCurrentlyPaused(){return this.pause||this.pauseWhenNotFocused&&!document.hasFocus()}startFrame(){if(this.isCurrentlyPaused())return this.input&&this.input.startFrame(),void(S=!0);S&&(S=!1,d.resetDelta()),this.pauseGameTime?d.resetDelta():d.update(),w=d.rawTimestamp(),m=new d,u.Animator.updatePlayingAnimations(m.delta);for(let t=0;t<_.length;++t)_[t].startFrame();T=!0}endFrame(){if(T){for(let t=0;t<_.length;++t)_[t].endFrame();T=!1}this.isCurrentlyPaused()?this.input&&this.input.endFrame():(g=m,m&&this.#w())}#w(){p++,x+=m.delta,x>=1&&(x=0,y=p,p=0,v=this.getAverageFrameTime(),b=1);let t=d.rawTimestamp();b++,v+=t-w}silent(){f=!0,s.silent()}throwErrorOnWarnings(t){if(void 0===t)throw Error("Must provide a value!");s.throwErrorOnWarnings(t)}get gameTime(){return m}get version(){return C}getFpsCount(){return y}getAverageFrameTime(){return 0===b?0:v/b}requestAnimationFrame(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(t):window.msRequestAnimationFrame?window.msRequestAnimationFrame(t):setTimeout(t,1e3/60)}cancelAnimationFrame(t){return window.cancelAnimationFrame?window.cancelAnimationFrame(t):window.mozCancelAnimationFrame?window.mozCancelAnimationFrame(t):void clearTimeout(t)}setLogger(t){s.setDrivers(t)}getLogger(t){return s.getLogger(t)}}},4882:t=>{const e=[];t.exports=class{constructor(t){this._target=t,this._fromValues={},this._toValues={},this._progress=0,this._onFinish=null,this._smoothDamp=!1,this._repeats=!1,this._repeatsWithReverseAnimation=!1,this._isInAutoUpdate=!1,this._originalFrom=null,this._originalTo=null,this._originalRepeats=null,this.speedFactor=1}update(t){if(!(this._progress>=1)){t*=this.speedFactor,this._progress+=t,this._progress>=1&&(this._progress=1,this._onFinish&&this._onFinish(this._target,this));for(let t in this._toValues){let i=this._toValues[t].keyParts,r=this._toValues[t].value,s=this._fromValues[t];if(void 0===s&&(this._fromValues[t]=s=this.#b(i),void 0===s))throw new Error(`Animator issue: missing origin value for key '${t}' and property not found in target object.`);"function"==typeof r&&(r=r()),"function"==typeof s&&(s=r());let n=this._smoothDamp&&this._progress<1?this._progress*(2-this._progress):this._progress,o=null;if("number"==typeof s)o=(1-(e=n))*s+e*r;else{if(!s.constructor.lerp)throw new Error(`Animator issue: from-value for key '${t}' is not a number, and its class type don't implement a 'lerp()' method!`);o=s.constructor.lerp(s,r,n)}this.#v(i,o)}var e;this._repeats&&this._progress>=1&&("number"==typeof this._repeats&&this._repeats--,this._progress=0,this._repeatsWithReverseAnimation&&this.flipFromAndTo())}}#b(t){return 1===t.length?this._target[t[0]]:t.reduce((function(t,e){return t[e]}),this._target)}#v(t,e){1!==t.length?t.slice(0,t.length-1).reduce((function(t,e){return t[e]}),this._target)[t[t.length-1]]=e:this._target[t[0]]=e}#T(t){return"number"==typeof t||"function"==typeof t||t&&t.constructor&&t.constructor.lerp}then(t){return this._onFinish=t,this}smoothDamp(t){return this._smoothDamp=t,this}repeats(t,e){return this._originalRepeats=this._repeats=t,this._repeatsWithReverseAnimation=Boolean(e),this}reverseBackToStart(){return this.repeats(1,!0)}from(t){for(let e in t){if(!this.#T(t[e]))throw new Error("Illegal value type to use with Animator! All values must be either numbers, methods, or a class instance that has a static lerp() method.");this._fromValues[e]=t[e]}return this._originalFrom=null,this}to(t){for(let e in t){if(!this.#T(t[e]))throw new Error("Illegal value type to use with Animator! All values must be either numbers, methods, or a class instance that has a static lerp() method.");this._toValues[e]={keyParts:e.split("."),value:t[e]}}return this._originalTo=null,this}flipFromAndTo(){let t={},e={};this._originalFrom||(this._originalFrom=this._fromValues),this._originalTo||(this._originalTo=this._toValues);for(let i in this._toValues)t[i]=this._toValues[i].value,e[i]={keyParts:i.split("."),value:this._fromValues[i]};this._fromValues=t,this._toValues=e}duration(t){return this.speedFactor=1/t,this}reset(){return this._originalFrom&&(this._fromValues=this._originalFrom),this._originalTo&&(this._toValues=this._originalTo),null!==this._originalRepeats&&(this._repeats=this._originalRepeats),this._progress=0,this}play(){if(!this._isInAutoUpdate)return e.push(this),this._isInAutoUpdate=!0,this}get ended(){return this._progress>=1}static updatePlayingAnimations(t){for(let i=e.length-1;i>=0;--i)e[i].update(t),e[i].ended&&(e[i]._isInAutoUpdate=!1,e.splice(i,1))}}},5891:(t,e,i)=>{const r=i(8329),s=new r;t.exports=class{constructor(t=new r(1/0,1/0,1/0),e=new r(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(s.fromArray(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=e.mul(.5);return this.min.copy(t.sub(i)),this.max.copy(t.add(i)),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(){return this.isEmpty()?r.zero():this.min.add(this.max).mulSelf(.5)}getSize(t){return this.isEmpty()?r.zero():this.max.sub(this.min)}expandByPoint(t){return this.min.minSelf(t),this.max.maxSelf(t),this}expandByVector(t){return this.min.subSelf(t),this.max.addSelf(t),this}expandByScalar(t){return this.min.subSelf(t),this.max.addSelf(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}collideBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}collideSphere(t){return this.clampPoint(t.center).distanceToSquared(t.center)<=t.radius*t.radius}collidePlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}clampPoint(t){return t.clampSelf(this.min,this.max)}distanceToPoint(t){return t.clamp(this.min,this.max).distanceTo(t)}intersectWith(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}unionWith(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}},9668:(t,e,i)=>{const r=i(9646),s=i(2544);class n{constructor(t,e){this.center=t.clone(),this.radius=e}clone(){return new n(this.center,this.radius)}containsVector(t){return this.center.distanceTo(t)<=this.radius}equals(t){return t===this||t&&t.constructor===this.constructor&&this.center.equals(t.center)&&this.radius==t.radius}static fromDict(t){return new n(s.fromDict(t.center||{}),t.radius||0)}toDict(t){if(t){const t={};return this.radius&&(t.radius=this.radius),(this.center.x||this.center.y)&&(t.center=this.center.toDict(!0)),t}return{center:this.center.toDict(),radius:this.radius}}static lerp(t,e,i){let o=r.lerp;return new n(s.lerp(t.center,e.center,i),o(t.radius,e.radius,i))}}t.exports=n},9327:(t,e,i)=>{const r=i(9646);class s{constructor(t,e,i,r){this.set(t,e,i,r)}set(t,e,i,r){return this._r=t,this._g=e,this._b=i,this._a=void 0===r?1:r,this._asHex=null,this}setByte(t,e,i,r){return this._r=t/255,this._g=e/255,this._b=i/255,this._a=void 0===r?1:r/255,this._asHex=null,this}copy(t){return this.set(t.r,t.g,t.b,t.a),this}get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}set r(t){return this._r=t,this._asHex=null,this._r}set g(t){return this._g=t,this._asHex=null,this._g}set b(t){return this._b=t,this._asHex=null,this._b}set a(t){return this._a=t,this._asHex=null,this._a}static componentToHex(t){var e=Math.round(t).toString(16);return 1==e.length?"0"+e:e}get asHex(){return this._asHex||(this._asHex="#"+s.componentToHex(255*this.r)+s.componentToHex(255*this.g)+s.componentToHex(255*this.b)+s.componentToHex(255*this.a)),this._asHex}static fromHex(t){if("string"!=typeof t&&"#"!=t[0])throw new PintarJS.Error("Invalid color format!");var e=l(t);if(!e)throw new Error("Invalid hex value to parse!");return new s(e.r,e.g,e.b,1)}static fromDecimal(t,e){let i=new s(1,1,1,1);e&&(i.a=(255&t)/255,t>>=8),i.b=(255&t)/255,t>>=8,i.g=(255&t)/255,t>>=8,i.r=(255&t)/255}static fromDict(t){return new s(void 0!==t.r?t.r:1,void 0!==t.g?t.g:1,void 0!==t.b?t.b:1,void 0!==t.a?t.a:1)}toDict(t){if(t){const t={};return 1!==this.r&&(t.r=this.r),1!==this.g&&(t.g=this.g),1!==this.b&&(t.b=this.b),1!==this.a&&(t.a=this.a),t}return{r:this.r,g:this.g,b:this.b,a:this.a}}get asDecimalRGBA(){return(Math.round(255*this.r)<<24|Math.round(255*this.g)<<16|Math.round(255*this.b)<<8|Math.round(255*this.a))>>>0}get asDecimalABGR(){return(Math.round(255*this.a)<<24|Math.round(255*this.b)<<16|Math.round(255*this.g)<<8|Math.round(255*this.r))>>>0}get floatArray(){return[this.r,this.g,this.b,this.a]}clone(){return new s(this.r,this.g,this.b,this.a)}string(){return this.r+","+this.g+","+this.b+","+this.a}get isBlack(){return 0==this.r&&0==this.g&&0==this.b}static random(t){return new s(Math.random(),Math.random(),Math.random(),t?Math.random():1)}static fromBytesArray(t,e){return new s(t[e=e||0]/255,t[e+1]/255,t[e+2]/255,void 0!==t[e+3]?t[e+3]/255:1)}get isTransparentBlack(){return this._r==this._g&&this._g==this._b&&this._b==this._a&&0==this._a}static get webColorNames(){return a}equals(t){return this===t||t&&t.constructor===this.constructor&&this._r==t._r&&this._g==t._g&&this._b==t._b&&this._a==t._a}static lerp(t,e,i){let n=r.lerp;return new s(n(t.r,e.r,i),n(t.g,e.g,i),n(t.b,e.b,i),n(t.a,e.a,i))}}const n={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};for(var o in n)n.hasOwnProperty(o)&&function(t){Object.defineProperty(s,o,{get:function(){return t.clone()}})}(l(n[o]));const a=Object.keys(n);function l(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,r){return e+e+i+i+r+r}));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),i=e?{r:parseInt(e[1],16)/255,g:parseInt(e[2],16)/255,b:parseInt(e[3],16)/255}:null;if(!i)throw new Error("Invalid hex value to parse!");return new s(i.r,i.g,i.b,1)}Object.freeze(a),Object.defineProperty(s,"transparent",{get:function(){return new s(0,0,0,0)}}),Object.defineProperty(s,"transwhite",{get:function(){return new s(1,1,1,0)}}),t.exports=s},4353:(t,e,i)=>{const r=i(5597),s=(i(5529),i(8329));i(5891);const n=new s;t.exports=class{constructor(t=new r,e=new r,i=new r,s=new r,n=new r,o=new r){this.planes=[t,e,i,s,n,o]}set(t,e,i,r,s,n){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(s),o[5].copy(n),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.values,r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5],h=i[6],u=i[7],d=i[8],c=i[9],f=i[10],_=i[11],g=i[12],m=i[13],p=i[14],x=i[15];return e[0].setComponents(o-r,u-a,_-d,x-g).normalizeSelf(),e[1].setComponents(o+r,u+a,_+d,x+g).normalizeSelf(),e[2].setComponents(o+s,u+l,_+c,x+m).normalizeSelf(),e[3].setComponents(o-s,u-l,_-c,x-m).normalizeSelf(),e[4].setComponents(o-n,u-h,_-f,x-p).normalizeSelf(),e[5].setComponents(o+n,u+h,_+f,x+p).normalizeSelf(),this}collideSphere(t){const e=this.planes,i=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<r)return!1;return!0}collideBox(t){const e=this.planes;for(let i=0;i<6;i++){const r=e[i];if(n.x=r.normal.x>0?t.max.x:t.min.x,n.y=r.normal.y>0?t.max.y:t.min.y,n.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(n)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}},4742:t=>{const e="undefined"!=typeof performance&&performance.now;function i(){return e?performance.now():Date.now()}var r=null,s=0,n=0;t.exports=class{constructor(){this.timestamp=n,this.deltaTime={milliseconds:s,seconds:s/1e3},this.elapsedTime={milliseconds:n,seconds:n/1e3},this.delta=this.deltaTime?this.deltaTime.seconds:null,this.elapsed=this.elapsedTime.seconds,Object.freeze(this)}static update(){let t=i(),e=0;r&&(e=t-r),r=t,s=e,n+=e}static rawTimestamp(){return i()}static reset(){r=null,s=0,n=0}static resetDelta(){r=null,s=0}}},3624:(t,e,i)=>{const r={Vector2:i(2544),Vector3:i(8329),Rectangle:i(4731),Circle:i(9668),Line:i(1708),Color:i(9327),Animator:i(4882),GameTime:i(4742),MathHelper:i(9646),SeededRandom:i(7212),Perlin:i(4476),Storage:i(7274),StorageAdapter:i(6553),PathFinder:i(2791),Transformation:i(1910),TransformationModes:i(6347),ItemsSorter:i(321),Frustum:i(4353),Plane:i(5597),Sphere:i(7517),Matrix:i(5529),Box:i(5891)};t.exports=r},321:(t,e,i)=>{i(4731);const r=i(2544);t.exports=class{static arrangeRectangles(t,e,i){i=i||r.zeroReadonly;let s=[];for(let e of t)s.push({width:(void 0!==e.width?e.width:e.x)+i.x,height:(void 0!==e.height?e.height:e.y)+i.y,source:e});t=s;let n=0,o=0;for(const e of t)n+=e.width*e.height,o=Math.max(o,e.width);t.sort(((t,e)=>e.height-t.height));let a=Math.max(Math.ceil(Math.sqrt(n/.95)),o);e&&(a=e(a));const l=[{x:0,y:0,w:a,h:1/0}];let h=0,u=0;for(const e of t)for(let t=l.length-1;t>=0;t--){const i=l[t];if(!(e.width>i.w||e.height>i.h)){if(e.x=i.x,e.y=i.y,u=Math.max(u,e.y+e.height),h=Math.max(h,e.x+e.width),e.width===i.w&&e.height===i.h){const e=l.pop();t<l.length&&(l[t]=e)}else e.height===i.h?(i.x+=e.width,i.w-=e.width):e.width===i.w?(i.y+=e.height,i.h-=e.height):(l.push({x:i.x+e.width,y:i.y,w:i.w-e.width,h:e.height}),i.y+=e.height,i.h-=e.height);break}}return{width:h,height:u,rectangles:t,utilized:n/(h*u)||0}}}},1708:(t,e,i)=>{const r=i(2544);class s{constructor(t,e){this.from=t.clone(),this.to=e.clone()}clone(){return new s(this.from,this.to)}static fromDict(t){return new s(r.fromDict(t.from||{}),r.fromDict(t.to||{}))}toDict(t){if(t){const t={};return(this.from.x||this.from.y)&&(t.from=this.from.toDict(!0)),(this.to.x||this.to.y)&&(t.to=this.to.toDict(!0)),t}return{from:this.from.toDict(),to:this.to.toDict()}}containsVector(t,e){let i=this.from,s=this.to,n=r.distance;return void 0===e&&(e=.5),Math.abs(n(i,t)+n(s,t)-n(i,s))<=e}collideLine(t){let e,i,r,s,n,o,a=this.from,l=this.to,h=t.from,u=t.to;return!!(a.equals(h)||a.equals(u)||l.equals(h)||l.equals(u))||(e=l.x-a.x,i=l.y-a.y,r=u.x-h.x,s=u.y-h.y,n=(-i*(a.x-h.x)+e*(a.y-h.y))/(-r*i+e*s),o=(r*(a.y-h.y)-s*(a.x-h.x))/(-r*i+e*s),n>=0&&n<=1&&o>=0&&o<=1)}distanceToVector(t){let e=this.from.x,i=this.to.x,r=this.from.y,s=this.to.y;var n,o,a=t.x-e,l=t.y-r,h=i-e,u=s-r,d=h*h+u*u,c=-1;0!=d&&(c=(a*h+l*u)/d),c<0?(n=e,o=r):c>1?(n=i,o=s):(n=e+c*h,o=r+c*u);var f=t.x-n,_=t.y-o;return Math.sqrt(f*f+_*_)}equals(t){return this===t||t&&t.constructor===this.constructor&&this.from.equals(t.from)&&this.to.equals(t.to)}static lerp(t,e,i){return new s(r.lerp(t.from,e.from,i),r.lerp(t.to,e.to,i))}}t.exports=s},9646:t=>{const e=Math.PI/180,i=180/Math.PI;class r{static lerp(t,e,i){return t===e?e:(1-i)*t+i*e}static dot(t,e,i,r){return t*i+e*r}static roundToMultiple(t,e){return(t+(t>=0)*(e-1))/e*e}static toRadians(t){return t*e}static toDegrees(t){return t*i}static radiansDistanceSigned(t,e){var i=2*Math.PI,r=(e-t)%i;return 2*r%i-r}static radiansDistance(t,e){return Math.abs(this.radiansDistanceSigned(t,e))}static degreesDistanceSigned(t,r){let s=t*e,n=r*e;return this.radiansDistanceSigned(s,n)*i}static degreesDistance(t,r){let s=t*e,n=r*e;return this.radiansDistance(s,n)*i}static lerpRadians(t,e,i){return t===e?e:t+this.radiansDistanceSigned(t,e)*i}static lerpDegrees(t,e,i){if(t===e)return e;t=this.toRadians(t),e=this.toRadians(e);var r=this.lerpRadians(t,e,i);return this.toDegrees(r)}static round10(t){return Math.round(1e8*t)/1e8}static wrapDegrees(t){return(t%=360)<0&&(t+=360),t}}r.PI2=2*Math.PI,t.exports=r},5529:(t,e,i)=>{const r=i(4288),s=i(2544),n=i(8329),o=Number.EPSILON;class a{constructor(t,e){t||(t=a.identity.values,e=!0),this.values=e||void 0===e?t.slice(0):t}set(t,e,i,r,s,n,o,a,l,h,u,d,c,f,_,g){this.values=new Float32Array([t,e,i,r,s,n,o,a,l,h,u,d,c,f,_,g])}clone(){return new a(this.values,!0)}equals(t){if(t===this)return!0;if(!t)return!1;for(let e=0;e<this.values.length;++e)if(this.values[e]!==t.values[e])return!1;return!0}inverted(){return this.clone().invertSelf()}invertSelf(){const t=this.values,e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],d=t[10],c=t[11],f=t[12],_=t[13],g=t[14],m=t[15],p=u*g*l-_*d*l+_*a*c-o*g*c-u*a*m+o*d*m,x=f*d*l-h*g*l-f*a*c+n*g*c+h*a*m-n*d*m,y=h*_*l-f*u*l+f*o*c-n*_*c-h*o*m+n*u*m,w=f*u*a-h*_*a-f*o*d+n*_*d+h*o*g-n*u*g,b=e*p+i*x+r*y+s*w;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/b;return t[0]=p*v,t[1]=(_*d*s-u*g*s-_*r*c+i*g*c+u*r*m-i*d*m)*v,t[2]=(o*g*s-_*a*s+_*r*l-i*g*l-o*r*m+i*a*m)*v,t[3]=(u*a*s-o*d*s-u*r*l+i*d*l+o*r*c-i*a*c)*v,t[4]=x*v,t[5]=(h*g*s-f*d*s+f*r*c-e*g*c-h*r*m+e*d*m)*v,t[6]=(f*a*s-n*g*s-f*r*l+e*g*l+n*r*m-e*a*m)*v,t[7]=(n*d*s-h*a*s+h*r*l-e*d*l-n*r*c+e*a*c)*v,t[8]=y*v,t[9]=(f*u*s-h*_*s-f*i*c+e*_*c+h*i*m-e*u*m)*v,t[10]=(n*_*s-f*o*s+f*i*l-e*_*l-n*i*m+e*o*m)*v,t[11]=(h*o*s-n*u*s-h*i*l+e*u*l+n*i*c-e*o*c)*v,t[12]=w*v,t[13]=(h*_*r-f*u*r+f*i*d-e*_*d-h*i*g+e*u*g)*v,t[14]=(f*o*r-n*_*r-f*i*a+e*_*a+n*i*g-e*o*g)*v,t[15]=(n*u*r-h*o*r+h*i*a-e*u*a-n*i*d+e*o*d)*v,this}static createOrthographic(t,e,i,r,s,n){return new a([2/(e-t),0,0,0,0,2/(r-i),0,0,0,0,2/(s-n),0,(t+e)/(t-e),(i+r)/(i-r),(s+n)/(s-n),1],!1)}static createPerspective(t,e,i,r){var s=1/Math.tan(t/2),n=1/(i-r);return new a([s/e,0,0,0,0,s,0,0,0,0,(i+r)*n,-1,0,0,i*r*n*2,0],!1)}static createTranslation(t,e,i){return new a([1,0,0,0,0,1,0,0,0,0,1,0,t||0,e||0,i||0,1],!1)}static createScale(t,e,i){return new a([t||1,0,0,0,0,e||1,0,0,0,0,i||1,0,0,0,0,1],!1)}static createRotationX(t){let e=Math.sin,i=Math.cos;return new a([1,0,0,0,0,i(t),-e(t),0,0,e(t),i(t),0,0,0,0,1],!1)}static createRotationY(t){let e=Math.sin,i=Math.cos;return new a([i(t),0,e(t),0,0,1,0,0,-e(t),0,i(t),0,0,0,0,1],!1)}static createRotationZ(t){let e=Math.sin,i=Math.cos;return new a([i(t),-e(t),0,0,e(t),i(t),0,0,0,0,1,0,0,0,0,1],!1)}static multiply(t,e){let i=[e.values[0],e.values[1],e.values[2],e.values[3]],r=[e.values[4],e.values[5],e.values[6],e.values[7]],s=[e.values[8],e.values[9],e.values[10],e.values[11]],n=[e.values[12],e.values[13],e.values[14],e.values[15]],o=l(t.values,i),h=l(t.values,r),u=l(t.values,s),d=l(t.values,n);return new a([o[0],o[1],o[2],o[3],h[0],h[1],h[2],h[3],u[0],u[1],u[2],u[3],d[0],d[1],d[2],d[3]],!1)}static createLookAt(t,e,i){const r=t,s=e,l=i||n.upReadonly;let h,u,d,c,f,_,g,m,p,x;if(Math.abs(r.x-s.x)<o&&Math.abs(r.y-s.y)<o&&Math.abs(r.z-s.z)<o)return a.identity.clone();g=r.x-s.x,m=r.y-s.y,p=r.z-s.z,x=1/Math.hypot(g,m,p),g*=x,m*=x,p*=x,h=l.y*p-l.z*m,u=l.z*g-l.x*p,d=l.x*m-l.y*g,x=Math.hypot(h,u,d),x?(x=1/x,h*=x,u*=x,d*=x):(h=0,u=0,d=0),c=m*d-p*u,f=p*h-g*d,_=g*u-m*h,x=Math.hypot(c,f,_),x?(x=1/x,c*=x,f*=x,_*=x):(c=0,f=0,_=0);const y=[];return y[0]=h,y[1]=c,y[2]=g,y[3]=0,y[4]=u,y[5]=f,y[6]=m,y[7]=0,y[8]=d,y[9]=_,y[10]=p,y[11]=0,y[12]=-(h*r.x+u*r.y+d*r.z),y[13]=-(c*r.x+f*r.y+_*r.z),y[14]=-(g*r.x+m*r.y+p*r.z),y[15]=1,new a(y,!1)}static multiplyMany(t){let e=t[0];for(let i=1;i<t.length;i++)e=a.multiply(e,t[i]);return e}static multiplyIntoFirst(t,e){let i=[e.values[0],e.values[1],e.values[2],e.values[3]],r=[e.values[4],e.values[5],e.values[6],e.values[7]],s=[e.values[8],e.values[9],e.values[10],e.values[11]],n=[e.values[12],e.values[13],e.values[14],e.values[15]],o=l(t.values,i),a=l(t.values,r),h=l(t.values,s),u=l(t.values,n);return t.set(o[0],o[1],o[2],o[3],a[0],a[1],a[2],a[3],h[0],h[1],h[2],h[3],u[0],u[1],u[2],u[3]),t}static multiplyManyIntoFirst(t){let e=t[0];for(let i=1;i<t.length;i++)e=a.multiplyIntoFirst(e,t[i]);return e}static transformVertex(t,e){return new r(e.position instanceof s?a.transformVector2(t,e.position):a.transformVector3(t,e.position),e.textureCoord,e.color)}static transformVector2(t,e){const i=e.x,r=e.y,n=e.z||0,o=t.values,a=1/(o[3]*i+o[7]*r+o[11]*n+o[15]),l=(o[0]*i+o[4]*r+o[8]*n+o[12])*a,h=(o[1]*i+o[5]*r+o[9]*n+o[13])*a;return new s(l,h)}static transformVector3(t,e){const i=e.x,r=e.y,s=e.z||0,o=t.values,a=1/(o[3]*i+o[7]*r+o[11]*s+o[15]),l=(o[0]*i+o[4]*r+o[8]*s+o[12])*a,h=(o[1]*i+o[5]*r+o[9]*s+o[13])*a,u=(o[2]*i+o[6]*r+o[10]*s+o[14])*a;return new n(l,h,u)}}function l(t,e){let i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],u=t[8],d=t[9],c=t[10],f=t[11],_=t[12],g=t[13],m=t[14],p=t[15],x=e[0],y=e[1],w=e[2],b=e[3];return[x*i+y*o+w*u+b*_,x*r+y*a+w*d+b*g,x*s+y*l+w*c+b*m,x*n+y*h+w*f+b*p]}a.identity=new a([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],!1),a.identity.isIdentity=!0,Object.freeze(a.identity),t.exports=a},2791:(t,e,i)=>{i(2544);class r{constructor(t){this.position=t,this.gCost=0,this.hCost=0,this.parent=null,this.price=1}get fCost(){return this.gCost+this.hCost}}function s(t,e){let i=[],r=e;for(;r!==t;)i.unshift(r.position),r=r.parent;return i}function n(t,e){let i=t.position.x-e.position.x,r=t.position.y-e.position.y;return Math.sqrt(i*i+r*r)}const o={findPath:function(t,e,i,o){return function(t,e,i,o){const a=o.allowDiagonal;let l={};function h(t){let e=t.x+","+t.y;if(l[e])return l[e];let i=new r(t);return l[e]=i,i}let u=h(e),d=h(i),c=[];c.push(u);let f=new Set;function _(t,e){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}let g=-1;for(;c.length>0&&!(o.maxIterations&&g++>o.maxIterations);){let e=c[0];for(let t=1;t<c.length;t++)c[t].fCost<=e.fCost&&c[t].hCost<e.hCost&&(e=c[t]);if(_(c,e),f.add(e),e==d)return s(u,d);let i=[];for(let t=-1;t<=1;t++)for(let r=-1;r<=1;r++)0===t&&0===r||(a||0===t||0===r)&&i.push(h({x:e.position.x+t,y:e.position.y+r,z:e.position.z}));for(let r of i){if(f.has(r)||t.isBlocked(e.position,r.position))continue;let i=o.ignorePrices?1:t.getPrice(r.position),s=e.gCost+n(e,r)*i,a=-1!==c.indexOf(r);(!a||s<r.gCost)&&(r.gCost=s,r.hCost=n(r,d),r.parent=e,a||c.push(r))}}return null}(t,e,i,o||{})},IGrid:class{isBlocked(t,e){throw new Error("Not Implemented")}getPrice(t){throw new Error("Not Implemented")}}};t.exports=o},4476:(t,e,i)=>{const r=i(9646).lerp;function s(t){return t*t*t*(t*(6*t-15)+10)}function n(t,e,i){this.x=t,this.y=e,this.z=i}n.prototype.dot2=function(t,e){return this.x*t+this.y*e};const o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];t.exports=class{constructor(t){void 0===t&&(t=Math.random()),this.seed(t)}seed(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=new Array(512),i=new Array(512),r=[new n(1,1,0),new n(-1,1,0),new n(1,-1,0),new n(-1,-1,0),new n(1,0,1),new n(-1,0,1),new n(1,0,-1),new n(-1,0,-1),new n(0,1,1),new n(0,-1,1),new n(0,1,-1),new n(0,-1,-1)],s=0;s<256;s++){var a;a=1&s?o[s]^255&t:o[s]^t>>8&255,e[s]=e[s+256]=a,i[s]=i[s+256]=r[a%12]}this._perm=e,this._gradP=i}generateSmooth(t,e,i,r){return void 0===i&&(i=.25),(this.generate(t-i,e-i,r)+this.generate(t+i,e+i,r)+this.generate(t-i,e+i,r)+this.generate(t+i,e-i,r))/4}generate(t,e,i){void 0===i&&(i=1);let n=this._perm,o=this._gradP;var a=Math.floor(t),l=Math.floor(e);t-=a,e-=l;var h=o[(a&=255)+n[l&=255]].dot2(t,e)*i,u=o[a+n[l+1]].dot2(t,e-1)*i,d=o[a+1+n[l]].dot2(t-1,e)*i,c=o[a+1+n[l+1]].dot2(t-1,e-1)*i,f=s(t);return Math.min(r(r(h,d,f),r(u,c,f),s(e))+.5,1)}}},5597:(t,e,i)=>{i(1708),i(7517);const r=i(8329);t.exports=class{constructor(t=new r(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalizeSelf(){const t=1/this.normal.length();return this.normal.mulSelf(t),this.constant*=t,this}normalized(){return this.clone().normalizeSelf()}negateSelf(){return this.constant*=-1,this.normal.mulSelf(-1),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}collideLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}collideSphere(t){return t.collidePlane(this)}coplanarPoint(){return this.normal.mul(-this.constant)}translateSelf(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}},4731:(t,e,i)=>{const r=i(9668),s=i(1708),n=i(9646),o=i(2544);class a{constructor(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i,this.height=r}set(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this}copy(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}getPosition(){return new o(this.x,this.y)}getSize(){return new o(this.width,this.height)}getCenter(){return new o(Math.round(this.x+this.width/2),Math.round(this.y+this.height/2))}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new a(this.x,this.y,this.width,this.height)}getTopLeft(){return new o(this.x,this.y)}getTopRight(){return new o(this.x+this.width,this.y)}getBottomLeft(){return new o(this.x,this.y+this.height)}getBottomRight(){return new o(this.x+this.width,this.y+this.height)}string(){return this.x+","+this.y+","+this.width+","+this.height}containsVector(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}collideRect(t){let e=this,i=t;return!(i.left>=e.right||i.right<=e.left||i.top>=e.bottom||i.bottom<=e.top)}collideLine(t){if(this.containsVector(t.from)||this.containsVector(t.to))return!0;let e=this.getTopLeft(),i=this.getTopRight(),r=this.getBottomLeft(),n=this.getBottomRight();return!!(t.collideLine(new s(e,i))||t.collideLine(new s(e,r))||t.collideLine(new s(i,n))||t.collideLine(new s(r,n)))}collideCircle(t){let e=t.center,i=t.radius,r=this;if(r.containsVector(e))return!0;let s=r.getCenter(),n=r.getTopLeft(),o=r.getTopRight(),a=r.getBottomRight(),h=r.getBottomLeft(),u=[];s.x>e.x?u.push([n,h]):u.push([o,a]),s.y>e.y?u.push([n,o]):u.push([h,a]);for(let t=0;t<u.length;++t)if(l(e,u[t][0],u[t][1])<=i)return!0;return!1}getBoundingCircle(){let t=this.getCenter(),e=t.distanceTo(this.getTopLeft());return new r(t,e)}static fromPoints(t){let e=t[0].x,i=t[0].y,r=e,s=i;for(let n=1;n<t.length;++n)e=Math.min(e,t[n].x),i=Math.min(i,t[n].y),r=Math.max(r,t[n].x),s=Math.max(s,t[n].y);return new a(e,i,r-e,s-i)}resize(t){return"number"==typeof t&&(t=new o(t,t)),new a(this.x-t.x/2,this.y-t.y/2,this.width+t.x,this.height+t.y)}equals(t){return this===t||t&&t.constructor===this.constructor&&this.x==t.x&&this.y==t.y&&this.width==t.width&&this.height==t.height}static lerp(t,e,i){let r=n.lerp;return new a(r(t.x,e.x,i),r(t.y,e.y,i),r(t.width,e.width,i),r(t.height,e.height,i))}static fromDict(t){return new a(t.x||0,t.y||0,t.width||0,t.height||0)}toDict(t){if(t){const t={};return this.x&&(t.x=this.x),this.y&&(t.y=this.y),this.width&&(t.width=this.width),this.height&&(t.height=this.height),t}return{x:this.x,y:this.y,width:this.width,height:this.height}}}function l(t,e,i){let r=t.x,s=t.y,n=e.x,o=e.y,a=i.x,l=i.y;var h,u,d=a-n,c=l-o,f=d*d+c*c,_=-1;0!=f&&(_=((r-n)*d+(s-o)*c)/f),_<0?(h=n,u=o):_>1?(h=a,u=l):(h=n+_*d,u=o+_*c);var g=r-h,m=s-u;return Math.sqrt(g*g+m*m)}t.exports=a},7212:t=>{t.exports=class{constructor(t){void 0===t&&(t=0),this.seed=t}random(t,e){this.seed=(9301*this.seed+49297)%233280;let i=this.seed/233280;return t&&e?t+i*(e-t):t?i*t:i}pick(t){return t[Math.floor(this.random(t.length))]}}},7517:(t,e,i)=>{const r=i(9646),s=i(8329);class n{constructor(t,e){this.center=t.clone(),this.radius=e}clone(){return new n(this.center,this.radius)}containsVector(t){return this.center.distanceTo(t)<=this.radius}equals(t){return t===this||t&&t.constructor===this.constructor&&this.center.equals(t.center)&&this.radius==t.radius}static fromDict(t){return new n(s.fromDict(t.center||{}),t.radius||0)}toDict(t){if(t){const t={};return this.radius&&(t.radius=this.radius),(this.center.x||this.center.y)&&(t.center=this.center.toDict(!0)),t}return{center:this.center.toDict(),radius:this.radius}}collideBox(t){return t.collideSphere(this)}collidePlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}static lerp(t,e,i){let o=r.lerp;return new n(s.lerp(t.center,e.center,i),o(t.radius,e.radius,i))}}t.exports=n},7274:(t,e,i)=>{const r=i(6553);class s{constructor(t,e,i,r){t=t||s.defaultAdapters,Array.isArray(t)||(t=[t]),this._adapter=null;for(let e of t)if(e.isValid()){this._adapter=e;break}this.valuesAsBase64=Boolean(i),this.keysAsBase64=Boolean(r),this._keysPrefix="shaku_storage_"+(e||"")+"_"}get persistent(){return this.isValid&&this._adapter.persistent}get isValid(){return Boolean(this._adapter)}normalizeKey(t){return t=this._keysPrefix+t.toString(),this.keysAsBase64&&(t=btoa(t)),t}exists(t){if("string"!=typeof t)throw new Error("Key must be a string!");return t=this.normalizeKey(t),this._adapter.exists(t)}#S(t,e){e=JSON.stringify({data:e,timestamp:(new Date).getTime(),src:"Shaku",sver:1}),this.valuesAsBase64&&(e=btoa(e)),this._adapter.setItem(t,e)}#C(t){var e=this._adapter.getItem(t);if(null===e)return null;if(this.valuesAsBase64)try{e=atob(e)}catch(t){throw new Error("Failed to parse Base64 string while reading data. Did you try to read a value as Base64 that wasn't encoded as Base64 when written to storage?")}try{e=JSON.parse(e)}catch(t){throw new Error("Failed to JSON-parse data from storage. Did you try to read something that wasn't written with the Storage utility?")}return e.data}setItem(t,e){if("string"!=typeof t)throw new Error("Key must be a string!");t=this.normalizeKey(t),this.#S(t,e)}getItem(t){if("string"!=typeof t)throw new Error("Key must be a string!");return t=this.normalizeKey(t),this.#C(t)}getJson(t){return this.getItem(t)||null}setJson(t,e){t=this.normalizeKey(t),this.#S(t,e)}deleteItem(t){if("string"!=typeof t)throw new Error("Key must be a string!");t=this.normalizeKey(t),this._adapter.deleteItem(t)}clear(){this._adapter.clear(this._keysPrefix)}}s.defaultAdapters=[new r.localStorage,new r.sessionStorage,new r.memory],t.exports=s},6553:t=>{class e{get persistent(){throw new Error("Not Implemented.")}isValid(){throw new Error("Not Implemented.")}exists(t){throw new Error("Not Implemented.")}setItem(t,e){throw new Error("Not Implemented.")}getItem(t){throw new Error("Not Implemented.")}deleteItem(t){throw new Error("Not Implemented.")}clear(t){throw new Error("Not Implemented.")}}e.memory=class{constructor(){this._data={}}get persistent(){return!1}isValid(){return!0}exists(t){return Boolean(this._data[t])}setItem(t,e){this._data[t]=e}getItem(t){return this._data[t]}deleteItem(t){delete this._data[t]}clear(t){for(let e in this._data)0===e.indexOf(t)&&delete this._data[e]}},e.localStorage=class{get persistent(){return!0}isValid(){try{return"undefined"!=typeof localStorage&&null!==localStorage}catch(t){return!1}}exists(t){return null!==localStorage.getItem(t)}setItem(t,e){localStorage.setItem(t,e)}getItem(t){return localStorage.getItem(t)}deleteItem(t){localStorage.deleteItem(t)}clear(t){for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);0===i.indexOf(t)&&localStorage.deleteItem(i)}}},e.sessionStorage=class{get persistent(){return!1}isValid(){try{return"undefined"!=typeof sessionStorage&&null!==sessionStorage}catch(t){return!1}}exists(t){return null!==sessionStorage.getItem(t)}setItem(t,e){sessionStorage.setItem(t,e)}getItem(t){return sessionStorage.getItem(t)}deleteItem(t){sessionStorage.deleteItem(t)}clear(t){for(let e=0;e<sessionStorage.length;e++){const i=sessionStorage.key(e);0===i.indexOf(t)&&sessionStorage.deleteItem(i)}}},t.exports=e},6347:t=>{t.exports={Relative:"relative",AxisAligned:"axis-aligned",Absolute:"absolute"}},1910:(t,e,i)=>{const r=i(9646),s=i(6347),n=i(5529),o=i(2544),a={};a.position=o.zero(),a.positionMode=s.Relative,a.scale=o.one(),a.scaleMode=s.AxisAligned,a.rotation=0,a.rotationMode=s.Relative;class l{constructor(t,e,i){this._position=t||a.position.clone(),this._positionMode=a.positionMode,this._scale=i||a.scale.clone(),this._scaleMode=a.scaleMode,this._rotation=e||a.rotation,this._rotationMode=a.rotationMode,this.onChange=null}getPosition(){return this._position.clone()}getPositionMode(){return this._positionMode}setPosition(t){if(!this._position.equals(t))return this._position.copy(t),this.#R(!0,!1),this}setPositionX(t){if(this._position.x!==t)return this._position.x=t,this.#R(!0,!1),this}setPositionY(t){if(this._position.y!==t)return this._position.y=t,this.#R(!0,!1),this}move(t){return this._position.addSelf(t),this.#R(!0,!1),this}setPositionMode(t){if(this._positionMode!==t)return this._positionMode=t,this.#R(!1,!0),this}getScale(){return this._scale.clone()}getScaleMode(){return this._scaleMode}setScale(t){if(!this._scale.equals(t))return this._scale.copy(t),this.#R(!0,!1),this}setScaleX(t){if(this._scale.x!==t)return this._scale.x=t,this.#R(!0,!1),this}setScaleY(t){if(this._scale.y!==t)return this._scale.y=t,this.#R(!0,!1),this}scale(t){return this._scale.mulSelf(t),this.#R(!0,!1),this}setScaleMode(t){if(this._scaleMode!==t)return this._scaleMode=t,this.#R(!1,!0),this}getRotation(){return this._rotation}getRotationDegrees(){return r.toDegrees(this._rotation)}getRotationDegreesWrapped(){let t=this.getRotationDegrees();return r.wrapDegrees(t)}getRotationMode(){return this._rotationMode}setRotation(t,e){if(this._rotation!==t)return this._rotation=t,e&&(this._rotation<0||this._rotation>2*Math.PI)&&(this._rotation=Math.atan2(Math.sin(this._rotation),Math.cos(this._rotation))),this.#R(!0,!1),this}rotate(t,e){return this.setRotation(this._rotation+t,e),this}setRotationDegrees(t,e){const i=r.toRadians(t,e);return this.setRotation(i)}rotateDegrees(t){return this._rotation+=r.toRadians(t),this.#R(!0,!1),this}setRotationMode(t){if(this._rotationMode!==t)return this._rotationMode=t,this.#R(!1,!0),this}#R(t,e){this._matrix=null,this.onChange&&this.onChange(this,t,e)}equals(t){return this._rotation===t._rotation&&this._position.equals(t._position)&&this._scale.equals(t._scale)}clone(){const t=new l(this._position.clone(),this._rotation,this._scale.clone());return t._rotationMode=this._rotationMode,t._positionMode=this._positionMode,t._scaleMode=this._scaleMode,t._matrix=this._matrix,t}serialize(){const t={};return this._position.equals(a.position)||(t.pos=this._position),this._positionMode!==a.positionMode&&(t.posm=this._positionMode),this._scale.equals(a.scale)||(t.scl=this._scale),this._scaleMode!==a.scaleMode&&(t.sclm=this._scaleMode),this._rotation!==a.rotation&&(t.rot=Math.floor(r.toDegrees(this._rotation))),this._rotationMode!==a.rotationMode&&(t.rotm=this._rotationMode),t}deserialize(t){this._position.copy(t.pos||a.position),this._scale.copy(t.scl||a.scale),this._rotation=r.toRadians(t.rot||a.rotation),this._positionMode=t.posm||a.positionMode,this._scaleMode=t.sclm||a.scaleMode,this._rotationMode=t.rotm||a.rotationMode,this.#R(!0,!0)}asMatrix(){if(this._matrix)return this._matrix;let t=[];return 0===this._position.x&&0===this._position.y||t.push(n.createTranslation(this._position.x,this._position.y,0)),this._rotation&&t.push(n.createRotationZ(-this._rotation)),1===this._scale.x&&1===this._scale.y||t.push(n.createScale(this._scale.x,this._scale.y)),0===t.length?this._matrix=n.identity:1===t.length?this._matrix=t[0]:this._matrix=n.multiplyMany(t),this._matrix}static combine(t,e){var i=function(t,e,i,r){switch(r){case s.Absolute:return t.clone();case s.AxisAligned:return e.add(t);case s.Relative:return e.add(t.rotatedByRadians(i._rotation));default:throw new Error("Unknown transform mode!")}}(t._position,e._position,e,t._positionMode),r=function(t,e,i,r){switch(r){case s.Absolute:return t.clone();case s.AxisAligned:return e.mul(t);case s.Relative:return e.mul(t.rotatedByRadians(i._rotation));default:throw new Error("Unknown transform mode!")}}(t._scale,e._scale,e,t._scaleMode),n=function(t,e,i,r){switch(r){case s.Absolute:return t;case s.AxisAligned:case s.Relative:return e+t;default:throw new Error("Unknown transform mode!")}}(t._rotation,e._rotation,0,t._rotationMode);return new l(i,n,r)}}t.exports=l},2544:(t,e,i)=>{const r=i(9646);class s{constructor(t=0,e=0){this.x=t,this.y=e}clone(){return new s(this.x,this.y)}set(t,e){return this.x=t,this.y=e,this}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return"number"==typeof t?new s(this.x+t,this.y+(void 0===arguments[1]?t:arguments[1])):new s(this.x+t.x,this.y+t.y)}sub(t){return"number"==typeof t?new s(this.x-t,this.y-(void 0===arguments[1]?t:arguments[1])):new s(this.x-t.x,this.y-t.y)}div(t){return"number"==typeof t?new s(this.x/t,this.y/(void 0===arguments[1]?t:arguments[1])):new s(this.x/t.x,this.y/t.y)}mul(t){return"number"==typeof t?new s(this.x*t,this.y*(void 0===arguments[1]?t:arguments[1])):new s(this.x*t.x,this.y*t.y)}round(){return new s(Math.round(this.x),Math.round(this.y))}floor(){return new s(Math.floor(this.x),Math.floor(this.y))}ceil(){return new s(Math.ceil(this.x),Math.ceil(this.y))}minSelf(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}maxSelf(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}min(t){this.clone().minSelf(t)}max(t){this.clone().maxSelf(t)}normalized(){if(0==this.x&&0==this.y)return s.zero();let t=this.length();return new s(this.x/t,this.y/t)}rotatedByRadians(t){return s.fromRadians(this.getRadians()+t).mulSelf(this.length())}rotatedByDegrees(t){return s.fromDegrees(this.getDegrees()+t).mulSelf(this.length())}addSelf(t){return"number"==typeof t?(this.x+=t,this.y+=void 0===arguments[1]?t:arguments[1]):(this.x+=t.x,this.y+=t.y),this}subSelf(t){return"number"==typeof t?(this.x-=t,this.y-=void 0===arguments[1]?t:arguments[1]):(this.x-=t.x,this.y-=t.y),this}divSelf(t){return"number"==typeof t?(this.x/=t,this.y/=void 0===arguments[1]?t:arguments[1]):(this.x/=t.x,this.y/=t.y),this}mulSelf(t){return"number"==typeof t?(this.x*=t,this.y*=void 0===arguments[1]?t:arguments[1]):(this.x*=t.x,this.y*=t.y),this}roundSelf(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}floorSelf(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceilSelf(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}normalizeSelf(){if(0==this.x&&0==this.y)return this;let t=this.length();return this.x/=t,this.y/=t,this}equals(t){return this===t||t.constructor===this.constructor&&this.x===t.x&&this.y===t.y}approximate(t,e){return e=e||1,this===t||Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}scaled(t){return new s(this.x*t,this.y*t)}static zero(){return new s(0,0)}static one(){return new s(1,1)}static half(){return new s(.5,.5)}static left(){return new s(-1,0)}static right(){return new s(1,0)}static up(){return new s(0,-1)}static down(){return new s(0,1)}static random(){return s.fromDegrees(360*Math.random())}degreesTo(t){return s.degreesBetween(this,t)}radiansTo(t){return s.radiansBetween(this,t)}wrappedDegreesTo(t){return s.wrappedDegreesBetween(this,t)}wrappedRadiansTo(t){return s.wrappedRadiansBetween(this,t)}distanceTo(t){return s.distance(this,t)}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}clamp(t,e){return this.clone().clampSelf(t,e)}clampSelf(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}dot(t){return this.x*t.x+this.y*t.y}static fromDegrees(t){let e=t*(Math.PI/180);return new s(Math.cos(e),Math.sin(e))}static fromRadians(t){return new s(Math.cos(t),Math.sin(t))}static lerp(t,e,i){let n=r.lerp;return new s(n(t.x,e.x,i),n(t.y,e.y,i))}static degreesBetween(t,e){let i=e.y-t.y,r=e.x-t.x;return Math.atan2(i,r)*(180/Math.PI)}static radiansBetween(t,e){return r.toRadians(s.degreesBetween(t,e))}static wrappedDegreesBetween(t,e){return e.sub(t).getDegrees()}getDegrees(){var t=180*Math.atan2(this.y,this.x)/Math.PI;return(360+Math.round(t))%360}getRadians(){return Math.atan2(this.y,this.x)}static wrappedRadiansBetween(t,e){return r.toRadians(s.wrappedDegreesBetween(t,e))}static distance(t,e){let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}static cross(t,e){return t.x*e.y-t.y*e.x}static dot(t,e){return t.x*e.x+t.y*e.y}string(){return this.x+","+this.y}static parse(t){let e=t.split(",");return new s(parseFloat(e[0].trim()),parseFloat(e[1].trim()))}toArray(){return[this.x,this.y]}static fromArray(t){return new s(t[0],t[1])}static fromDict(t){return new s(t.x||0,t.y||0)}toDict(t){if(t){const t={};return this.x&&(t.x=this.x),this.y&&(t.y=this.y),t}return{x:this.x,y:this.y}}}s.zeroReadonly=new s(0,0),Object.freeze(s.zeroReadonly),s.oneReadonly=new s(1,1),Object.freeze(s.oneReadonly),s.halfReadonly=new s(.5,.5),Object.freeze(s.halfReadonly),s.leftReadonly=new s(-1,0),Object.freeze(s.leftReadonly),s.rightReadonly=new s(1,0),Object.freeze(s.rightReadonly),s.upReadonly=new s(0,-1),Object.freeze(s.upReadonly),s.downReadonly=new s(0,1),Object.freeze(s.downReadonly),t.exports=s},8329:(t,e,i)=>{const r=i(9646);class s{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}clone(){return new s(this.x,this.y,this.z)}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return"number"==typeof t?new s(this.x+t,this.y+(void 0===arguments[1]?t:arguments[1]),this.z+(void 0===arguments[2]?t:arguments[2])):new s(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return"number"==typeof t?new s(this.x-t,this.y-(void 0===arguments[1]?t:arguments[1]),this.z-(void 0===arguments[2]?t:arguments[2])):new s(this.x-t.x,this.y-t.y,this.z-t.z)}div(t){return"number"==typeof t?new s(this.x/t,this.y/(void 0===arguments[1]?t:arguments[1]),this.z/(void 0===arguments[2]?t:arguments[2])):new s(this.x/t.x,this.y/t.y,this.z/t.z)}mul(t){return"number"==typeof t?new s(this.x*t,this.y*(void 0===arguments[1]?t:arguments[1]),this.z*(void 0===arguments[2]?t:arguments[2])):new s(this.x*t.x,this.y*t.y,this.z*t.z)}round(){return new s(Math.round(this.x),Math.round(this.y),Math.round(this.z))}floor(){return new s(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new s(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}normalized(){if(0==this.x&&0==this.y&&0==this.z)return s.zero;let t=this.length();return new s(this.x/t,this.y/t,this.z/t)}addSelf(t){return"number"==typeof t?(this.x+=t,this.y+=void 0===arguments[1]?t:arguments[1],this.z+=void 0===arguments[2]?t:arguments[2]):(this.x+=t.x,this.y+=t.y,this.z+=t.z),this}subSelf(t){return"number"==typeof t?(this.x-=t,this.y-=void 0===arguments[1]?t:arguments[1],this.z-=void 0===arguments[2]?t:arguments[2]):(this.x-=t.x,this.y-=t.y,this.z-=t.z),this}divSelf(t){return"number"==typeof t?(this.x/=t,this.y/=void 0===arguments[1]?t:arguments[1],this.z/=void 0===arguments[2]?t:arguments[2]):(this.x/=t.x,this.y/=t.y,this.z/=t.z),this}mulSelf(t){return"number"==typeof t?(this.x*=t,this.y*=void 0===arguments[1]?t:arguments[1],this.z*=void 0===arguments[2]?t:arguments[2]):(this.x*=t.x,this.y*=t.y,this.z*=t.z),this}roundSelf(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}floorSelf(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceilSelf(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}normalizeSelf(){if(0==this.x&&0==this.y&&0==this.z)return this;let t=this.length();return this.x/=t,this.y/=t,this.z/=t,this}equals(t){return this===t||t.constructor===this.constructor&&this.x===t.x&&this.y===t.y&&this.z===t.z}approximate(t,e){return e=e||1,this===t||Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e&&Math.abs(this.z-t.z)<=e}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}scaled(t){return new s(this.x*t,this.y*t,this.z*t)}static zero(){return new s(0,0,0)}static one(){return new s(1,1,1)}static half(){return new s(.5,.5,.5)}static left(){return new s(-1,0,0)}static right(){return new s(1,0,0)}static up(){return new s(0,1,0)}static down(){return new s(0,-1,0)}static front(){return new s(0,0,1)}static back(){return new s(0,0,-1)}distanceTo(t){return s.distance(this,t)}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}clamp(t,e){return this.clone().clampSelf(t,e)}clampSelf(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}static lerp(t,e,i){let n=r.lerp;return new s(n(t.x,e.x,i),n(t.y,e.y,i),n(t.z,e.z,i))}static distance(t,e){let i=t.x-e.x,r=t.y-e.y,s=t.z-e.z;return Math.sqrt(i*i+r*r+s*s)}static crossVector(t,e){const i=t.x,r=t.y,n=t.z,o=e.x,a=e.y,l=e.z;return new s(r*l-n*a,n*o-i*l,i*a-r*o)}minSelf(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}maxSelf(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}min(t){this.clone().minSelf(t)}max(t){this.clone().maxSelf(t)}string(){return this.x+","+this.y+","+this.z}static parse(t){let e=t.split(",");return new s(parseFloat(e[0].trim()),parseFloat(e[1].trim()),parseFloat(e[2].trim()))}toArray(){return[this.x,this.y,this.z]}static fromArray(t){return new s(t[0],t[1],t[2])}static fromDict(t){return new s(t.x||0,t.y||0,t.z||0)}toDict(t){if(t){const t={};return this.x&&(t.x=this.x),this.y&&(t.y=this.y),this.z&&(t.z=this.z),t}return{x:this.x,y:this.y,z:this.z}}}s.zeroReadonly=new s(0,0,0),Object.freeze(s.zeroReadonly),s.oneReadonly=new s(1,1,1),Object.freeze(s.oneReadonly),s.halfReadonly=new s(.5,.5,.5),Object.freeze(s.halfReadonly),s.leftReadonly=new s(-1,0,0),Object.freeze(s.leftReadonly),s.rightReadonly=new s(1,0,0),Object.freeze(s.rightReadonly),s.upReadonly=new s(0,1,0),Object.freeze(s.upReadonly),s.downReadonly=new s(0,-1,0),Object.freeze(s.downReadonly),s.frontReadonly=new s(0,0,1),Object.freeze(s.frontReadonly),s.backReadonly=new s(0,0,-1),Object.freeze(s.backReadonly),t.exports=s}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i(8138)})();